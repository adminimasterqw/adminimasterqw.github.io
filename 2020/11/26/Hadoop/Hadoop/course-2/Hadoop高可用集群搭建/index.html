<!-- build time:Thu Feb 11 2021 12:51:55 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Andrésen" href="https://methiony.work/rss.xml"><link rel="alternate" type="application/atom+xml" title="Andrésen" href="https://methiony.work/atom.xml"><link rel="alternate" type="application/json" title="Andrésen" href="https://methiony.work/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.4"><link rel="canonical" href="https://methiony.work/2020/11/26/Hadoop/Hadoop/course-2/Hadoop%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"><title>Hadoop高可用集群搭建 - Hadoop基础知识 - Hadoop - 大数据应用 | Andrésen Blog = Andrésen</title><meta name="generator" content="Hexo 5.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Hadoop高可用集群搭建</h1><div class="meta"><span class="item" title="创建时间：2020-11-26 15:42:16"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2020-11-26T15:42:16+08:00">2020-11-26</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>13k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>12 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Andrésen Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s3.ax1x.com/2021/02/10/y0h6t1.jpg"></li><li class="item" data-background-image="https://s3.ax1x.com/2021/02/11/y0IClV.jpg"></li><li class="item" data-background-image="https://s3.ax1x.com/2021/02/11/y05HQf.jpg"></li><li class="item" data-background-image="https://s3.ax1x.com/2021/02/11/y0IQOO.jpg"></li><li class="item" data-background-image="https://s3.ax1x.com/2021/02/11/y0IWcV.png"></li><li class="item" data-background-image="https://s3.ax1x.com/2021/02/11/y0Id6f.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Hadoop/" itemprop="item" rel="index" title="分类于 大数据应用"><span itemprop="name">大数据应用</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Hadoop/Hadoop/" itemprop="item" rel="index" title="分类于 Hadoop"><span itemprop="name">Hadoop</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Hadoop/Hadoop/course-2/" itemprop="item" rel="index" title="分类于 Hadoop基础知识"><span itemprop="name">Hadoop基础知识</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://methiony.work/2020/11/26/Hadoop/Hadoop/course-2/Hadoop%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Andrésen"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Andrésen"></span><div class="body md" itemprop="articleBody"><div class="note info"><p>以下为个人学习笔记<br>课程： 大数据自学教程 Hadoop 从零到精通完整版 @<span class="exturl" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vNTg2Mzg5MDQ5">黑马程序员大数据教程</span><br><span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMWVrNHkxMTdZcQ==">https://www.bilibili.com/video/BV1ek4y117Yq</span></p></div><h1 id="hadoop高可用集群搭建"><a class="anchor" href="#hadoop高可用集群搭建">#</a> Hadoop 高可用集群搭建</h1><h2 id="1-环境准备"><a class="anchor" href="#1-环境准备">#</a> 1、环境准备</h2><p>用其他工具将 hadoop-2.6.0、zookeeper-3.4.5、jdk1.8.0_271 放入 node01 主机 /usr/local/src 目录下</p><h3 id="主机配置环境如下表"><a class="anchor" href="#主机配置环境如下表">#</a> 主机配置环境如下表</h3><table><thead><tr><th>主机名</th><th>IP</th><th>系统</th><th>软件版本</th><th>安装目录</th><th>数据目录</th></tr></thead><tbody><tr><td>node01</td><td>192.168.2.131</td><td>Centos 7</td><td>hadoop-2.6.0、jdk1.8、zookeeper-3.4.5</td><td>/usr/local/src/hadoop</td><td>/data/hadoop</td></tr><tr><td>node02</td><td>192.168.2.132</td><td>Centos 7</td><td>hadoop-2.6.0、jdk1.8、zookeeper-3.4.5</td><td>/usr/local/src/hadoop</td><td>/data/hadoop</td></tr><tr><td>node03</td><td>192.168.2.133</td><td>Centos 7</td><td>hadoop-2.6.0、jdk1.8、zookeeper-3.4.5</td><td>/usr/local/src/hadoop</td><td>/data/hadoop</td></tr></tbody></table><h3 id="集群规划"><a class="anchor" href="#集群规划">#</a> 集群规划</h3><table><thead><tr><th>node01</th><th>node02</th><th>node03</th></tr></thead><tbody><tr><td>NodeManager</td><td>NodeManager</td><td>NodeManager</td></tr><tr><td>NameNode</td><td>NameNode</td><td></td></tr><tr><td>DataNode</td><td>DataNode</td><td>DataNode</td></tr><tr><td>DFSZKFailoverController</td><td>DFSZKFailoverController</td><td></td></tr><tr><td>JournalNode</td><td>JournalNode</td><td>JournalNode</td></tr><tr><td>ResourceManager</td><td>ResourceManager</td><td></td></tr><tr><td>QuorumPeerMain</td><td>QuorumPeerMain</td><td>QuorumPeerMain</td></tr></tbody></table><h3 id="配置主机名以及解析3台"><a class="anchor" href="#配置主机名以及解析3台">#</a> 配置主机名以及解析（3 台）</h3><p>配置主机名</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># hostnamectl set-hostname node01</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node02 ~]</span><span class="token comment"># hostnamectl set-hostname node02</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token namespace">[root@node03 ~]</span><span class="token comment"># hostnamectl set-hostname node03</span></pre></td></tr></table></figure><p>配置域名解析（主机配置然后复制到其他机器上）</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># vi /etc/hosts</span></pre></td></tr><tr><td data-num="2"></td><td><pre>127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1   localhost localhost<span class="token punctuation">.</span>localdomain localhost4 localhost4<span class="token punctuation">.</span>localdomain4</pre></td></tr><tr><td data-num="3"></td><td><pre>::1         localhost localhost<span class="token punctuation">.</span>localdomain localhost6 localhost6<span class="token punctuation">.</span>localdomain6</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>131 node01</pre></td></tr><tr><td data-num="6"></td><td><pre>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>132 node02</pre></td></tr><tr><td data-num="7"></td><td><pre>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>133 node03</pre></td></tr></table></figure><h3 id="配置主机ip地址我的网卡是ifcfg-ens33"><a class="anchor" href="#配置主机ip地址我的网卡是ifcfg-ens33">#</a> 配置主机 IP 地址（我的网卡是 ifcfg-ens33）</h3><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># vi /etc/sysconfig/network-scripts/ifcfg-ens33</span></pre></td></tr></table></figure><p>node01 配置信息</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre>BOOTPROTO=none</pre></td></tr><tr><td data-num="2"></td><td><pre>ONBOOT=yes</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>文件末尾追加</pre></td></tr><tr><td data-num="5"></td><td><pre>IPADDR=192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>131</pre></td></tr><tr><td data-num="6"></td><td><pre>GATEWAY=192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>2</pre></td></tr><tr><td data-num="7"></td><td><pre>NETMASK=255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>0</pre></td></tr><tr><td data-num="8"></td><td><pre>DNS1=8<span class="token punctuation">.</span>8<span class="token punctuation">.</span>8<span class="token punctuation">.</span>8</pre></td></tr></table></figure><p>node02 配置信息</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre>BOOTPROTO=none</pre></td></tr><tr><td data-num="2"></td><td><pre>ONBOOT=yes</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>文件末尾追加</pre></td></tr><tr><td data-num="5"></td><td><pre>IPADDR=192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>132</pre></td></tr><tr><td data-num="6"></td><td><pre>GATEWAY=192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>2</pre></td></tr><tr><td data-num="7"></td><td><pre>NETMASK=255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>0</pre></td></tr><tr><td data-num="8"></td><td><pre>DNS1=8<span class="token punctuation">.</span>8<span class="token punctuation">.</span>8<span class="token punctuation">.</span>8</pre></td></tr></table></figure><p>node02 配置信息</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre>BOOTPROTO=none</pre></td></tr><tr><td data-num="2"></td><td><pre>ONBOOT=yes</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>文件末尾追加</pre></td></tr><tr><td data-num="5"></td><td><pre>IPADDR=192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>133</pre></td></tr><tr><td data-num="6"></td><td><pre>GATEWAY=192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>2</pre></td></tr><tr><td data-num="7"></td><td><pre>NETMASK=255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>255<span class="token punctuation">.</span>0</pre></td></tr><tr><td data-num="8"></td><td><pre>DNS1=8<span class="token punctuation">.</span>8<span class="token punctuation">.</span>8<span class="token punctuation">.</span>8</pre></td></tr></table></figure><h3 id="关闭防火墙"><a class="anchor" href="#关闭防火墙">#</a> 关闭防火墙</h3><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># systemctl stop firewalld.service </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#关闭防火墙</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># systemctl disable firewalld.service </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#禁止开机启动</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token operator">*</span><span class="token comment"># firewall-cmd --state </span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#查看防火墙状态</span></pre></td></tr><tr><td data-num="7"></td><td><pre>not running</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token namespace">[root@node02 ~]</span><span class="token comment"># systemctl stop firewalld.service </span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">#关闭防火墙</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token namespace">[root@node02 ~]</span><span class="token comment"># systemctl disable firewalld.service </span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">#禁止开机启动</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token namespace">[root@node02 ~]</span><span class="token operator">*</span><span class="token comment"># firewall-cmd --state </span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">#查看防火墙状态</span></pre></td></tr><tr><td data-num="15"></td><td><pre>not running</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token namespace">[root@node03 ~]</span><span class="token comment"># systemctl stop firewalld.service </span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">#关闭防火墙</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token namespace">[root@node03 ~]</span><span class="token comment"># systemctl disable firewalld.service </span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">#禁止开机启动</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token namespace">[root@node03 ~]</span><span class="token operator">*</span><span class="token comment"># firewall-cmd --state </span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">#查看防火墙状态</span></pre></td></tr><tr><td data-num="23"></td><td><pre>not running</pre></td></tr></table></figure><h3 id="关闭selinux"><a class="anchor" href="#关闭selinux">#</a> 关闭 selinux</h3><p>进入到 /etc/selinux/config 文件，将 SELINUX=enforcing 改为 SELINUX=disabled。</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment">#  vi  /etc/selinux/config</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node02 ~]</span><span class="token comment">#  vi  /etc/selinux/config</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token namespace">[root@node03 ~]</span><span class="token comment">#  vi  /etc/selinux/config</span></pre></td></tr></table></figure><p>重启</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># reboot</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node02 ~]</span><span class="token comment"># reboot</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token namespace">[root@node03 ~]</span><span class="token comment"># reboot</span></pre></td></tr></table></figure><h3 id="设置免密登录"><a class="anchor" href="#设置免密登录">#</a> 设置免密登录</h3><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#第一步，ssh-keygen -t rsa 生成密钥对</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># ssh-keygen -t rsa</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 连续三次回车，即在本地生成了公钥和私钥，不设置密码，默认存储在～/.ssh 目录下</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#第二步，用 ssh-copy-id 拷贝将公钥复制到远程机器中</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># ssh-copy-id -i .ssh/id_rsa.pub root@node01</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># ssh-copy-id -i .ssh/id_rsa.pub root@node02</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># ssh-copy-id -i .ssh/id_rsa.pub root@node03</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">#第三步，测试免密码登陆</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># ssh node02</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment"># ssh node03</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">#第四步，在其他机器重复操作</span></pre></td></tr></table></figure><h2 id="2-搭建环境"><a class="anchor" href="#2-搭建环境">#</a> 2、搭建环境</h2><h3 id="1-安装jdk已安装可以跳过"><a class="anchor" href="#1-安装jdk已安装可以跳过">#</a> 1、安装 jdk（已安装可以跳过）</h3><p>解压 jdk</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment">#tar -zxvf jdk-8u271-linux-x64.tar.gz</span></pre></td></tr></table></figure><p>配置环境变量 (/etc/profile)</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment">#vi /etc/profile</span></pre></td></tr></table></figure><p>添加</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre>export JAVA_HOME=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src<span class="token operator">/</span>jdk1<span class="token punctuation">.</span>8<span class="token punctuation">.</span>0_271 </pre></td></tr><tr><td data-num="2"></td><td><pre>export PATH=:<span class="token variable">$JAVA_HOME</span><span class="token operator">/</span>bin:<span class="token variable">$PATH</span></pre></td></tr></table></figure><p>执行下面命令，让环境变量生效</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment">#source /etc/profile</span></pre></td></tr></table></figure><p>验证 jdk 安装是否成功</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment">#java -version</span></pre></td></tr></table></figure><p>拷贝分发到 node1、node2</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment">#scp -r jdk1.8.0_271 node2:$PWD</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment">#scp -r jdk1.8.0_271 node3:$PWD</span></pre></td></tr></table></figure><h3 id="2-安装zookeeper已安装可以跳过"><a class="anchor" href="#2-安装zookeeper已安装可以跳过">#</a> 2、安装 zookeeper（已安装可以跳过）</h3><p>解压</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment"># tar -zxvf zookeeper-3.4.5.tar.gz</span></pre></td></tr></table></figure><p>配置修改</p><p>/usr/local/src/zookeeper-3.4.5/conf 这个路径下的 zoo_sample.cfg 修改为 zoo.cfg (如果存在 zoo.cfg 文件则不需要拷贝 zoo_sample.cfg)</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 conf]</span><span class="token comment"># mv zoo_sample.cfg zoo.cfg</span></pre></td></tr></table></figure><p>打开 zoo.cfg 文件，修改 dataDir 路径，添加主机</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre>dataDir=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src<span class="token operator">/</span>zookeeper<span class="token operator">-</span>3<span class="token punctuation">.</span>4<span class="token punctuation">.</span>5<span class="token operator">/</span>zkData</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>文件内容末尾添加内容</pre></td></tr><tr><td data-num="4"></td><td><pre>server<span class="token punctuation">.</span>1=master:2888:3888</pre></td></tr><tr><td data-num="5"></td><td><pre>server<span class="token punctuation">.</span>2=node1:2888:3888</pre></td></tr><tr><td data-num="6"></td><td><pre>server<span class="token punctuation">.</span>3=node2:2888:3888</pre></td></tr></table></figure><p>在 /usr/local/src/zookeeper-3.4.5 / 这个目录上创建 zkData 文件夹</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 zookeeper-3.4.5]</span><span class="token comment"># mkdir zkData</span></pre></td></tr></table></figure><p>在 /usr/local/src/zookeeper-3.4.5/zkData 这个目录上创建 myid 文件</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 zkData]</span><span class="token comment"># touch myid</span></pre></td></tr></table></figure><p>编辑 myid 文件 (其他机器上修改对应的 server 的数字)</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 zkData]</span><span class="token comment"># vi myid</span></pre></td></tr></table></figure><pre><code>1
</code></pre><p>拷贝分发到 node1、node2</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment"># scp -r zookeeper-3.4.5 node2:$PWD</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment"># scp -r zookeeper-3.4.5 node3:$PWD</span></pre></td></tr></table></figure><p>修改 node02、node03 的 myid 文件</p><h3 id="3-安装hadoop"><a class="anchor" href="#3-安装hadoop">#</a> 3、安装 Hadoop</h3><h4 id="1-解压hadoop"><a class="anchor" href="#1-解压hadoop">#</a> 1、解压 hadoop</h4><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment">#tar -zxvf hadoop-2.6.0.tar.gz</span></pre></td></tr></table></figure><p>配置环境变量 (/etc/profile)</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment">#vi /etc/profile</span></pre></td></tr></table></figure><p>添加</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre>export HADOOP_HOME=<span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src<span class="token operator">/</span>hadoop<span class="token operator">-</span>2<span class="token punctuation">.</span>6<span class="token punctuation">.</span>0</pre></td></tr><tr><td data-num="2"></td><td><pre>export PATH=:<span class="token variable">$HADOOP_HOME</span><span class="token operator">/</span>bin:<span class="token variable">$HADOOP_HOME</span><span class="token operator">/</span>sbin:<span class="token variable">$PATH</span></pre></td></tr></table></figure><p>执行下面命令，让环境变量生效</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 /]</span><span class="token comment">#source /etc/profile</span></pre></td></tr></table></figure><h4 id="2-修改hadoop的配置文件"><a class="anchor" href="#2-修改hadoop的配置文件">#</a> 2、修改 hadoop 的配置文件</h4><p>进入需改文件的目录</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01~]</span><span class="token comment">#cd /usr/local/src/hadoop-2.6.0/etc/hadoop</span></pre></td></tr></table></figure><p>需要修改的文件</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre>mapred<span class="token operator">-</span>env<span class="token punctuation">.</span>sh	hadoop<span class="token operator">-</span>env<span class="token punctuation">.</span>sh	yarn<span class="token operator">-</span>env<span class="token punctuation">.</span>sh	</pre></td></tr><tr><td data-num="2"></td><td><pre>core<span class="token operator">-</span>site<span class="token punctuation">.</span>xml	mapred<span class="token operator">-</span>site<span class="token punctuation">.</span>xml	yarn<span class="token operator">-</span>site<span class="token punctuation">.</span>xml	hdfs<span class="token operator">-</span>site<span class="token punctuation">.</span>xml</pre></td></tr></table></figure><h5 id="core-sitexml"><a class="anchor" href="#core-sitexml">#</a> core-site.xml</h5><p>修改 core-site.xml 文件，在 &lt;configuration&gt; 元素中添加相应的配置文件</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token comment">&lt;!-- 指定 hdfs 连接地址，集群模式（高可用）--></span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>fs.defaultFS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>hdfs://cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">&lt;!-- 指定 Hadoop 工作目录 --></span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>hadoop.tmp.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/usr/local/src/hadoop-2.6.0/tmpdata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token comment">&lt;!-- 指定 ZooKeeper 集群的地址和端口。注意，数量一定是奇数，且不少于三个节点 --></span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>ha.zookeeper.quorum<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>node01:2181,node02:2181,node03:2181<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h5 id="hdfs-sitexml"><a class="anchor" href="#hdfs-sitexml">#</a> hdfs-site.xml</h5><p>修改 hdfs-site.xml 文件，在 &lt;configuration&gt; 元素中添加相应的配置文件</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token comment">&lt;!-- 指定 HDFS 副本的数量，不能超过机器节点数 --></span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.replication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token comment">&lt;!-- 为 namenode 集群定义一个 services name --></span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre> 		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.nameservices<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token comment">&lt;!-- nameservice 包含哪些 namenode，为各个 namenode 起名 --></span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.ha.namenodes.cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>nn01,nn02<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre> 	<span class="token comment">&lt;!-- 名为 nn01 的 namenode 的 rpc 地址和端口号，rpc 用来和 datanode 通讯 --></span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.rpc-address.cluster.nn01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>node01:9000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre> 	<span class="token comment">&lt;!-- 名为 nn01 的 namenode 的 http 地址和端口号，用来和 web 客户端通讯 --></span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="24"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.http-address.cluster.nn01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>node01:50070<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="27"></td><td><pre> 	<span class="token comment">&lt;!-- 名为 nn02 的 namenode 的 rpc 地址和端口号，rpc 用来和 datanode 通讯 --></span></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="29"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.rpc-address.cluster.nn02<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="30"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>node02:9000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="32"></td><td><pre> 	<span class="token comment">&lt;!-- 名为 nn02 的 namenode 的 http 地址和端口号，用来和 web 客户端通讯 --></span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="34"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.http-address.cluster.nn02<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="35"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>node02:50070<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="36"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="37"></td><td><pre>  	<span class="token comment">&lt;!-- namenode 间用于共享编辑日志的 journal 节点列表 --></span></pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="39"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.namenode.shared.edits.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="40"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>qjournal://node01:8485;node02:8485;node03:8485/cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="41"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token comment">&lt;!-- journalnode 上用于存放 edits 日志的目录 --></span></pre></td></tr><tr><td data-num="43"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="44"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.journalnode.edits.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="45"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/data/hadoop/journaldata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="46"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="47"></td><td><pre>  	<span class="token comment">&lt;!-- 指定该集群出现故障时，是否自动切换到另一台 namenode --></span></pre></td></tr><tr><td data-num="48"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="49"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.ha.automatic-failover.enabled.cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="50"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="51"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="52"></td><td><pre>	<span class="token comment">&lt;!-- 配置失败自动切换实现方式 --></span></pre></td></tr><tr><td data-num="53"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="54"></td><td><pre>    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.client.failover.proxy.provider.cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="55"></td><td><pre> 		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="56"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="57"></td><td><pre>   </pre></td></tr><tr><td data-num="58"></td><td><pre>  	<span class="token comment">&lt;!-- 一旦需要 NameNode 切换，使用 ssh 方式进行操作 --></span></pre></td></tr><tr><td data-num="59"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="60"></td><td><pre>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.ha.fencing.methods<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="62"></td><td><pre>sshfence</pre></td></tr><tr><td data-num="63"></td><td><pre>shell(/bin/true)</pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token comment">&lt;!-- 以上为基本配置 --></span></pre></td></tr><tr><td data-num="67"></td><td><pre>    </pre></td></tr><tr><td data-num="68"></td><td><pre>  	<span class="token comment">&lt;!-- 如果使用 ssh 进行故障切换，使用 ssh 通信时用的密钥存储的位置 --></span></pre></td></tr><tr><td data-num="69"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="70"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.ha.fencing.ssh.private-key-files<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="71"></td><td><pre>  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/root/.ssh/id_rsa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="72"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="73"></td><td><pre>	<span class="token comment">&lt;!-- connect-timeout 超时时间 --></span></pre></td></tr><tr><td data-num="74"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="75"></td><td><pre>    		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.ha.fencing.ssh.connect-timeout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="76"></td><td><pre>    		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>30000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="77"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="78"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="79"></td><td><pre>   		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.name.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="80"></td><td><pre>   		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/data/hadoop/tmp/dfs/name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="81"></td><td><pre>   	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="82"></td><td><pre>   	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="83"></td><td><pre>   		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.data.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="84"></td><td><pre>   		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/data/hadoop/tmp/dfs/data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="85"></td><td><pre>   	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h5 id="yarn-sitexml"><a class="anchor" href="#yarn-sitexml">#</a> yarn-site.xml</h5><p>修改 yarn-site.xml 文件，在 &lt;configuration&gt; 元素中添加相应的配置文件</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token comment">&lt;!-- 启用 Resource Manager HA 高可用性 --></span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.ha.enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token comment">&lt;!-- 指定 resourcemanager 的名字 --></span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.cluster-id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>yrc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token comment">&lt;!-- 使用了 2 个 resourcemanager, 分别指定 Resourcemanager 的地址 --></span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.ha.rm-ids<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>rm1,rm2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token comment">&lt;!-- 指定 rm1 的地址 --></span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.hostname.rm1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>node01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token comment">&lt;!-- 指定 rm2 的地址  --></span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="24"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.hostname.rm2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>node02<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="27"></td><td><pre>	<span class="token comment">&lt;!-- 指定 zookeeper 集群机器 --></span></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="29"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.zk-address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="30"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>node01:2181,node02:2181,node03:2181<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token comment">&lt;!-- NodeManager 上运行的附属服务，默认是 mapreduce_shuffle --></span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.nodemanager.aux-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="35"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>mapreduce_shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="36"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token comment">&lt;!-- 制定 resourcemanager 的状态信息存储在 zookeeper 集群上 --></span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>yarn.resourcemanager.store.class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span> </pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h5 id="mapred-sitexml"><a class="anchor" href="#mapred-sitexml">#</a> mapred-site.xml</h5><p>修改 mapred-site.xml 文件，在 &lt;configuration&gt; 元素中添加相应的配置文件</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token comment">&lt;!-- 采用 yarn 作为 mapreduce 的资源调度框架 --></span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>mapreduce.framework.name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>yarn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h5 id="hadoop-envsh"><a class="anchor" href="#hadoop-envsh">#</a> <span class="exturl" data-url="aHR0cDovL2hhZG9vcC1lbnYuc2g=">hadoop-env.sh</span>、<span class="exturl" data-url="aHR0cDovL21hcHJlZC1lbnYuc2g=">mapred-env.sh</span>、<span class="exturl" data-url="aHR0cDovL3lhcm4tZW52LnNo">yarn-env.sh</span></h5><p>然后，<span class="exturl" data-url="aHR0cDovL3huLS1oYWRvb3AtZW52LXl1NnA1NHIwbmE1NjF0LnNo">分别修改 hadoop-env.sh</span>、<span class="exturl" data-url="aHR0cDovL21hcHJlZC1lbnYuc2g=">mapred-env.sh</span>、yarn-env.sh 文件，添加 Java 环境变量</p><p><span class="exturl" data-url="aHR0cDovL2hhZG9vcC1lbnYuc2g=">hadoop-env.sh</span></p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre># The java implementation to use.</pre></td></tr><tr><td data-num="2"></td><td><pre>export JAVA_HOME=/usr/local/src/jdk1.8.0_271</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre># 指定hadoop相关的pid存放位置</pre></td></tr><tr><td data-num="5"></td><td><pre>export HADOOP_PID_DIR=/usr/local/src/hadoop-2.6.0/pids</pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cDovL21hcHJlZC1lbnYuc2g=">mapred-env.sh</span></p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre># The java implementation to use.</pre></td></tr><tr><td data-num="2"></td><td><pre>export JAVA_HOME=/usr/local/src/jdk1.8.0_271</pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cDovL3lhcm4tZW52LnNo">yarn-env.sh</span></p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre>export JAVA_HOME=/usr/local/src/jdk1.8.0_271</pre></td></tr></table></figure><h5 id="配置hadoop环境变量可省略"><a class="anchor" href="#配置hadoop环境变量可省略">#</a> 配置 hadoop 环境变量 (可省略)</h5><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 hadoop]</span><span class="token comment">#vi /etc/profile.d/hadoop.sh</span></pre></td></tr></table></figure><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre>export HADOOP_HOME=/usr/local/src/hadoop-2.6.0</pre></td></tr><tr><td data-num="2"></td><td><pre>export LD_LIBRARY_PATH=$HADOOP_HOME/lib/native</pre></td></tr><tr><td data-num="3"></td><td><pre>export HADOOP_COMMON_LIB_NATIVE_DIR=/usr/local/src/hadoop-2.6.0/lib/native</pre></td></tr><tr><td data-num="4"></td><td><pre>export HADOOP_OPTS="-Djava.library.path=/usr/local/src/hadoop-2.6.0/lib"</pre></td></tr><tr><td data-num="5"></td><td><pre>export PATH=$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH</pre></td></tr></table></figure><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 hadoop]</span><span class="token comment">#source /etc/profile.d/hadoop.sh</span></pre></td></tr></table></figure><p>修改集群配置文件 slaves（没有则新建）</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 hadoop]</span><span class="token comment">#vi slaves</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>node01</pre></td></tr><tr><td data-num="4"></td><td><pre>node02</pre></td></tr><tr><td data-num="5"></td><td><pre>node03</pre></td></tr></table></figure><p>最后创建需要的相关目录</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 hadoop-2.6.0]</span><span class="token comment">#mkdir -p data/hadoop</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node01 hadoop-2.6.0]</span><span class="token comment">#cd data/hadoop</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token namespace">[root@node01 hadoop]</span><span class="token comment">#mkdir journaldata</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token namespace">[root@node01 hadoop]</span><span class="token comment">#mkdir -p tmp/dfs/name</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token namespace">[root@node01 hadoop]</span><span class="token comment">#mkdir -p tmp/dfs/data</span></pre></td></tr></table></figure><h4 id="3-拷贝复制到其它机器"><a class="anchor" href="#3-拷贝复制到其它机器">#</a> 3、拷贝复制到其它机器</h4><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment">#scp -r hadoop-2.6.0 node02:$PWD</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment">#scp -r hadoop-2.6.0 node03:$PWD</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment">#scp -r /etc/profile node02:/etc/profile</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment">#scp -r /etc/profile node03:/etc/profile</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment">#scp -r /etc/profile.d/hadoop.sh node02:/etc/profile.d/hadoop.sh</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token namespace">[root@node01 src]</span><span class="token comment">#scp -r /etc/profile.d/hadoop.sh node03:/etc/profile.d/hadoop.sh</span></pre></td></tr></table></figure><p>生效环境变量</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node02 hadoop]</span><span class="token comment">#source /etc/profile.d/hadoop.sh</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node02 hadoop]</span><span class="token comment">#source /etc/profile.d/hadoop.sh</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token namespace">[root@node02 /]</span><span class="token comment">#source /etc/profile</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token namespace">[root@node03 /]</span><span class="token comment">#source /etc/profile</span></pre></td></tr></table></figure><h4 id="4-启动hadoop"><a class="anchor" href="#4-启动hadoop">#</a> 4、启动 hadoop</h4><h5 id="执行格式化操作"><a class="anchor" href="#执行格式化操作">#</a> 执行格式化操作</h5><p>1、启动 journalnode，三台机器都要这一步操作（仅第一次启动 hadoop 时，需要这一步操作，之后不再需要手动启动 journalnode）</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 ~]</span><span class="token comment">#cd /usr/local/src/hadoop-2.6.0/sbin</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node01 sbin]</span><span class="token comment">#sh hadoop-daemon.sh start journalnode</span></pre></td></tr></table></figure><p>2、在 node01 上执行格式化操作，格式化 namenode 和 zkfc</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 hadoop-2.6.0]</span><span class="token comment">#hdfs namenode -format</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node01 hadoop-2.6.0]</span><span class="token comment">#hdfs zkfc -formatZK</span></pre></td></tr></table></figure><p>3、namenode 主从信息同步，在 node02 节点上执行同步命令</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 hadoop-2.6.0]</span><span class="token comment">#bin/hdfs namenode -bootstrapStandby</span></pre></td></tr></table></figure><p>上述步骤完成后，接下来我们就可以启动 hadoop 了</p><h5 id="启动命令"><a class="anchor" href="#启动命令">#</a> 启动命令</h5><p>在 node01 机器上执行下面的命令</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#sbin/start-all.sh</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#sbin/hadoop-daemon.sh start zkfc</span></pre></td></tr></table></figure><p>在 node02 机器上执行下面的命令</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node02 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#sbin/yarn-daemon.sh start resourcemanager</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@node02 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#sbin/hadoop-daemon.sh start zkfc</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@node02 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#hadoop-daemon.sh start namenode</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#如果无法启动 namenode, 可以试一下执行同步命令</span></pre></td></tr><tr><td data-num="6"></td><td><pre>bin/hdfs namenode -bootstrapStandby</pre></td></tr></table></figure><h5 id="停止命令"><a class="anchor" href="#停止命令">#</a> 停止命令</h5><p>在 node01 机器上执行下面的命令</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 hadoop-2.6.0]</span><span class="token comment">#sbin/stop-all.sh</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node01 hadoop-2.6.0]</span><span class="token comment">#sbin/hadoop-daemon.sh stop zkfc</span></pre></td></tr></table></figure><p>在 node02 机器上执行下面的命令</p><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node02 hadoop-2.6.0]</span><span class="token comment">#sbin/yarn-daemon.sh stop resourcemanager</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token namespace">[root@node02 hadoop-2.6.0]</span><span class="token comment">#sbin/hadoop-daemon.sh stop zkfc</span></pre></td></tr></table></figure><h5 id="查看每台节点的进程"><a class="anchor" href="#查看每台节点的进程">#</a> 查看每台节点的进程</h5><figure class="highlight powershell"><figcaption data-lang="PowerShell"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token namespace">[root@node01 hadoop-2.6.0]</span><span class="token comment">#jps</span></pre></td></tr><tr><td data-num="2"></td><td><pre> NodeManager</pre></td></tr><tr><td data-num="3"></td><td><pre> QuorumPeerMain</pre></td></tr><tr><td data-num="4"></td><td><pre> DFSZKFailoverController</pre></td></tr><tr><td data-num="5"></td><td><pre> DataNode</pre></td></tr><tr><td data-num="6"></td><td><pre> JournalNode</pre></td></tr><tr><td data-num="7"></td><td><pre> 5804 NameNode</pre></td></tr><tr><td data-num="8"></td><td><pre> ResourceManager</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token namespace">[root@node02 hadoop-2.6.0]</span><span class="token comment">#jps</span></pre></td></tr><tr><td data-num="11"></td><td><pre> JournalNode</pre></td></tr><tr><td data-num="12"></td><td><pre> NameNode</pre></td></tr><tr><td data-num="13"></td><td><pre> QuorumPeerMain</pre></td></tr><tr><td data-num="14"></td><td><pre> DFSZKFailoverController</pre></td></tr><tr><td data-num="15"></td><td><pre> ResourceManager</pre></td></tr><tr><td data-num="16"></td><td><pre> DataNode</pre></td></tr><tr><td data-num="17"></td><td><pre> NodeManager</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token namespace">[root@node03 hadoop-2.6.0]</span><span class="token comment">#jps</span></pre></td></tr><tr><td data-num="20"></td><td><pre> QuorumPeerMain</pre></td></tr><tr><td data-num="21"></td><td><pre> NodeManager</pre></td></tr><tr><td data-num="22"></td><td><pre> DataNode</pre></td></tr><tr><td data-num="23"></td><td><pre> JournalNode</pre></td></tr></table></figure><h2 id="3-通过web界面查看hadoop信息"><a class="anchor" href="#3-通过web界面查看hadoop信息">#</a> 3、通过 Web 界面查看 hadoop 信息</h2><p>1、浏览器访问 http://192.168.2.131:50070	(active 节点，即 namenode 主节点)</p><p>2、浏览器访问 http://192.168.2.132:50070	(standby 节点，即 namenode 备节点)</p><p>3、查看 yarn 的 web 控制台，浏览器访问 http://192.168.2.131:8088</p><h2 id="4-测试namenode高可用"><a class="anchor" href="#4-测试namenode高可用">#</a> 4、测试 namenode 高可用</h2><p>1、在 node01 上 kill 掉 namenode 进程，然后通过浏览器查看 node02 的状态，发现状态变为 active，说明高可用测试成功</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#kill -9 5804 (NameNode 进程号）</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#hdfs haadmin -getServiceState nn02</span></pre></td></tr><tr><td data-num="4"></td><td><pre>active</pre></td></tr></table></figure><p>2、重新启动 node01 的 namenode 进程，浏览器访问 node01，此时 node01 的状态为 standby</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#sbin/hadoop-daemon.sh start namenode</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#hdfs haadmin -getServiceState nn01</span></pre></td></tr><tr><td data-num="4"></td><td><pre>standby</pre></td></tr></table></figure><h2 id="5-查看状态"><a class="anchor" href="#5-查看状态">#</a> 5、查看状态</h2><h3 id="hdfs状态"><a class="anchor" href="#hdfs状态">#</a> HDFS 状态</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#hdfs dfsadmin -report</span></pre></td></tr></table></figure><h3 id="节点的主备状态"><a class="anchor" href="#节点的主备状态">#</a> 节点的主备状态</h3><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#yarn rmadmin -getServiceState rm1</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#yarn rmadmin -getServiceState rm2</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#hdfs haadmin -getServiceState nn01</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@node01 hadoop-2.6.0<span class="token punctuation">]</span><span class="token comment">#hdfs haadmin -getServiceState nn02</span></pre></td></tr></table></figure><h2 id="6-动态增加-删除节点"><a class="anchor" href="#6-动态增加-删除节点">#</a> 6、动态增加、删除节点</h2><h3 id="增加节点"><a class="anchor" href="#增加节点">#</a> 增加节点</h3><p>新节点中设置无密码登陆</p><p>在 Namenode 节点中设置到新节点的无密码登陆</p><p>在 Namenode 节点 slaves 文件中添加新节点</p><p>在所有节点 /etc/hosts 文件中增加新节点名</p><p>启动 datanode 进程，在新节点中执行</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>hadoop-deamon.sh start datanode</pre></td></tr></table></figure><p>均衡数据节点的数据</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>sbin/start-balancer.sh</pre></td></tr></table></figure><p>设置平衡阈值，默认是 10%，值越低各节点越平衡，但消耗时间也更长</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>sbin/start-balancer.sh -threshold <span class="token number">5</span></pre></td></tr></table></figure><p>设 balance 宽带，默认为 1M/s</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>hdfs dfsadmin -setBalancer Band width <span class="token number">2017520</span></pre></td></tr></table></figure><p>配置宽带，设置节点平衡带宽设置（默认值 1M，下面设置为 10M）</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.datanode.balance.bandwidthPerSec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>20971520<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h3 id="删除节点"><a class="anchor" href="#删除节点">#</a> 删除节点</h3><p>修改 Namenode 节点的 hdfs-site.xml 增加，设置节点排除文件的位置（必须是绝对路径）</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>dfs.hosts.exclude<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>/soft/hadoop/conf/excludes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>新建 excludes 文件，文件里写要删除节点的 hostname，在 excludes 文件中添加要排除的节点主机名，一行一个</p><p>Namenode 节点执行</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>hadoop dfsadmin –refreshNodes</pre></td></tr></table></figure><p>可在要移除的节点上运行相应的关闭命令，如：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>hadoop-daemon.sh stop datanode</pre></td></tr></table></figure><p>如果刚删除的节点要再添加到集群要先删除 excludes 文件，执行</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>hadoop dfsadmin –refreshNodes</pre></td></tr></table></figure><h2 id="7-重装"><a class="anchor" href="#7-重装">#</a> 7、重装</h2><p>删除 hadoop-2.6.0 和 zookeeper-3.4.5, 然后重新配置</p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-02-11 11:50:12" itemprop="dateModified" datetime="2021-02-11T11:50:12+08:00">2021-02-11</time> </span><span id="2020/11/26/Hadoop/Hadoop/course-2/Hadoop高可用集群搭建/" class="item leancloud_visitors" data-flag-title="Hadoop高可用集群搭建" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Andrésen 微信支付"><p>微信支付</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Andrésen <i class="ic i-at"><em>@</em></i>Andrésen</li><li class="link"><strong>本文链接：</strong> <a href="https://methiony.work/2020/11/26/Hadoop/Hadoop/course-2/Hadoop%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" title="Hadoop高可用集群搭建">https://methiony.work/2020/11/26/Hadoop/Hadoop/course-2/Hadoop高可用集群搭建/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2020/11/25/Hadoop/Hadoop/course-2/HDFS%E7%9A%84API%E6%93%8D%E4%BD%9C/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s3.ax1x.com&#x2F;2021&#x2F;02&#x2F;10&#x2F;y0h2p6.jpg" title="HDFS的API操作"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Hadoop基础知识</span><h3>HDFS的API操作</h3></a></div><div class="item right"><a href="/2020/11/27/Hadoop/Mapreduce/course-3/MapReduce%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s3.ax1x.com&#x2F;2021&#x2F;02&#x2F;10&#x2F;y0hD0J.jpg" title="MapReduce基本概念"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Mapreduce基础知识</span><h3>MapReduce基本概念</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#hadoop%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">Hadoop 高可用集群搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.1.</span> <span class="toc-text">1、环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%A6%82%E4%B8%8B%E8%A1%A8"><span class="toc-number">1.1.1.</span> <span class="toc-text">主机配置环境如下表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92"><span class="toc-number">1.1.2.</span> <span class="toc-text">集群规划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D%E4%BB%A5%E5%8F%8A%E8%A7%A3%E6%9E%903%E5%8F%B0"><span class="toc-number">1.1.3.</span> <span class="toc-text">配置主机名以及解析（3 台）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BAip%E5%9C%B0%E5%9D%80%E6%88%91%E7%9A%84%E7%BD%91%E5%8D%A1%E6%98%AFifcfg-ens33"><span class="toc-number">1.1.4.</span> <span class="toc-text">配置主机 IP 地址（我的网卡是 ifcfg-ens33）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">1.1.5.</span> <span class="toc-text">关闭防火墙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%ADselinux"><span class="toc-number">1.1.6.</span> <span class="toc-text">关闭 selinux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="toc-number">1.1.7.</span> <span class="toc-text">设置免密登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-number">1.2.</span> <span class="toc-text">2、搭建环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85jdk%E5%B7%B2%E5%AE%89%E8%A3%85%E5%8F%AF%E4%BB%A5%E8%B7%B3%E8%BF%87"><span class="toc-number">1.2.1.</span> <span class="toc-text">1、安装 jdk（已安装可以跳过）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85zookeeper%E5%B7%B2%E5%AE%89%E8%A3%85%E5%8F%AF%E4%BB%A5%E8%B7%B3%E8%BF%87"><span class="toc-number">1.2.2.</span> <span class="toc-text">2、安装 zookeeper（已安装可以跳过）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85hadoop"><span class="toc-number">1.2.3.</span> <span class="toc-text">3、安装 Hadoop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%A7%A3%E5%8E%8Bhadoop"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">1、解压 hadoop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9hadoop%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">2、修改 hadoop 的配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#core-sitexml"><span class="toc-number">1.2.3.2.1.</span> <span class="toc-text">core-site.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hdfs-sitexml"><span class="toc-number">1.2.3.2.2.</span> <span class="toc-text">hdfs-site.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#yarn-sitexml"><span class="toc-number">1.2.3.2.3.</span> <span class="toc-text">yarn-site.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mapred-sitexml"><span class="toc-number">1.2.3.2.4.</span> <span class="toc-text">mapred-site.xml</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hadoop-envsh"><span class="toc-number">1.2.3.2.5.</span> <span class="toc-text">hadoop-env.sh、mapred-env.sh、yarn-env.sh</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEhadoop%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%8F%AF%E7%9C%81%E7%95%A5"><span class="toc-number">1.2.3.2.6.</span> <span class="toc-text">配置 hadoop 环境变量 (可省略)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%8B%B7%E8%B4%9D%E5%A4%8D%E5%88%B6%E5%88%B0%E5%85%B6%E5%AE%83%E6%9C%BA%E5%99%A8"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">3、拷贝复制到其它机器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%90%AF%E5%8A%A8hadoop"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">4、启动 hadoop</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.3.4.1.</span> <span class="toc-text">执行格式化操作</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.3.4.2.</span> <span class="toc-text">启动命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.3.4.3.</span> <span class="toc-text">停止命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%AF%8F%E5%8F%B0%E8%8A%82%E7%82%B9%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.2.3.4.4.</span> <span class="toc-text">查看每台节点的进程</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%80%9A%E8%BF%87web%E7%95%8C%E9%9D%A2%E6%9F%A5%E7%9C%8Bhadoop%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.</span> <span class="toc-text">3、通过 Web 界面查看 hadoop 信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B5%8B%E8%AF%95namenode%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">1.4.</span> <span class="toc-text">4、测试 namenode 高可用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%9F%A5%E7%9C%8B%E7%8A%B6%E6%80%81"><span class="toc-number">1.5.</span> <span class="toc-text">5、查看状态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hdfs%E7%8A%B6%E6%80%81"><span class="toc-number">1.5.1.</span> <span class="toc-text">HDFS 状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E7%9A%84%E4%B8%BB%E5%A4%87%E7%8A%B6%E6%80%81"><span class="toc-number">1.5.2.</span> <span class="toc-text">节点的主备状态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%8A%A8%E6%80%81%E5%A2%9E%E5%8A%A0-%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9"><span class="toc-number">1.6.</span> <span class="toc-text">6、动态增加、删除节点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E8%8A%82%E7%82%B9"><span class="toc-number">1.6.1.</span> <span class="toc-text">增加节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9"><span class="toc-number">1.6.2.</span> <span class="toc-text">删除节点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E9%87%8D%E8%A3%85"><span class="toc-number">1.7.</span> <span class="toc-text">7、重装</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2020/11/21/Hadoop/Hadoop/course-2/Hadoop%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" rel="bookmark" title="Hadoop分布式集群搭建">Hadoop分布式集群搭建</a></li><li><a href="/2020/11/24/Hadoop/Hadoop/course-2/Hadoop%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/" rel="bookmark" title="Hadoop基本介绍及相关知识">Hadoop基本介绍及相关知识</a></li><li><a href="/2020/11/25/Hadoop/Hadoop/course-2/HDFS%E7%9A%84%E6%96%87%E4%BB%B6%E5%8F%8A%E5%85%83%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86/" rel="bookmark" title="HDFS的文件及元数据管理">HDFS的文件及元数据管理</a></li><li><a href="/2020/11/25/Hadoop/Hadoop/course-2/HDFS%E7%9A%84API%E6%93%8D%E4%BD%9C/" rel="bookmark" title="HDFS的API操作">HDFS的API操作</a></li><li class="active"><a href="/2020/11/26/Hadoop/Hadoop/course-2/Hadoop%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" rel="bookmark" title="Hadoop高可用集群搭建">Hadoop高可用集群搭建</a></li><li><a href="/2020/12/04/Hadoop/Hadoop/course-2/Hdaoop%E7%9A%84%E4%BC%AA%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" rel="bookmark" title="Hdaoop的伪分布式集群搭建">Hdaoop的伪分布式集群搭建</a></li><li><a href="/2020/12/04/Hadoop/Hadoop/course-2/Hadoop%E9%9B%86%E7%BE%A4%E7%9A%84%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0/" rel="bookmark" title="三种Hadoop集群的文件配置参数">三种Hadoop集群的文件配置参数</a></li><li><a href="/2020/12/14/Hadoop/Hadoop/course-2/Hadoop%E9%9B%86%E7%BE%A4%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3/" rel="bookmark" title="Hadoop集群文件配置参数详解">Hadoop集群文件配置参数详解</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Andrésen" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Andrésen</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">29</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">16</span> <span class="name">分类</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FkbWluaW1hc3RlcnF3" title="https:&#x2F;&#x2F;github.com&#x2F;adminimasterqw"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9xdWFuLXdlaS0zNy05" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;quan-wei-37-9"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTQ4ODg0NDc5NQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;488844795"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vNTgzMzM1MjYxMy9wcm9maWxlP3JpZ2h0bW9kPTEmd3ZyPTYmbW9kPXBlcnNvbmluZm8maXNfYWxsPTE=" title="https:&#x2F;&#x2F;weibo.com&#x2F;5833352613&#x2F;profile?rightmod&#x3D;1&amp;wvr&#x3D;6&amp;mod&#x3D;personinfo&amp;is_all&#x3D;1"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS93ZWkucXVhbg==" title="https:&#x2F;&#x2F;about.me&#x2F;wei.quan"><i class="ic i-address-card"></i></span> <span class="exturl item email" data-url="bWFpbHRvOjEwMTE2NDQ2OTdAcXEuY29t" title="mailto:1011644697@qq.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>链接</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2020/11/25/Hadoop/Hadoop/course-2/HDFS%E7%9A%84API%E6%93%8D%E4%BD%9C/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2020/11/27/Hadoop/Mapreduce/course-3/MapReduce%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Hadoop/" title="分类于 大数据应用">大数据应用</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Zookeeper/" title="分类于 Zookeeper">Zookeeper</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Zookeeper/course-1/" title="分类于 Zookeeper基础知识">Zookeeper基础知识</a></div><span><a href="/2020/11/21/Hadoop/Zookeeper/course-1/Zookeeper%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/" title="Zookeeper快速搭建">Zookeeper快速搭建</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hadoop/" title="分类于 大数据应用">大数据应用</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Hive/" title="分类于 Hive">Hive</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Hive/course-5/" title="分类于 Hive基础知识">Hive基础知识</a></div><span><a href="/2020/12/04/Hadoop/Hive/course-5/Hive%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" title="Hive的基本概念">Hive的基本概念</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hadoop/" title="分类于 大数据应用">大数据应用</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Hive/" title="分类于 Hive">Hive</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Hive/course-5/" title="分类于 Hive基础知识">Hive基础知识</a></div><span><a href="/2020/11/27/Hadoop/Hive/course-5/Hive%E6%A6%82%E8%BF%B0/" title="Hive概述">Hive概述</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MySQL/" title="分类于 MySQL">MySQL</a> <i class="ic i-angle-right"></i> <a href="/categories/MySQL/course-1/" title="分类于 MySQL基础知识">MySQL基础知识</a></div><span><a href="/2020/11/28/MySQL/course-1/Centos7%E4%B8%8BLinux%E7%B3%BB%E7%BB%9FMySQL%E5%AE%89%E8%A3%85/" title="Centos7下Linux系统MySQL安装">Centos7下Linux系统MySQL安装</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2020/11/15/MySQL/course-1/MySQL/" title="MySQL">MySQL</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hadoop/" title="分类于 大数据应用">大数据应用</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Yarn/" title="分类于 Yarn">Yarn</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Yarn/course-4/" title="分类于 Yarn基础知识">Yarn基础知识</a></div><span><a href="/2020/11/27/Hadoop/Yarn/course-4/Yarn%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E8%BF%B0/" title="Yarn的基本概述">Yarn的基本概述</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hadoop/" title="分类于 大数据应用">大数据应用</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Hive/" title="分类于 Hive">Hive</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Hive/course-5/" title="分类于 Hive基础知识">Hive基础知识</a></div><span><a href="/2020/12/04/Hadoop/Hive/course-5/Hive%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9/" title="Hive的数据压缩">Hive的数据压缩</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hadoop/" title="分类于 大数据应用">大数据应用</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Hadoop/" title="分类于 Hadoop">Hadoop</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Hadoop/course-2/" title="分类于 Hadoop基础知识">Hadoop基础知识</a></div><span><a href="/2020/11/24/Hadoop/Hadoop/course-2/Hadoop%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/" title="Hadoop基本介绍及相关知识">Hadoop基本介绍及相关知识</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hadoop/" title="分类于 大数据应用">大数据应用</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Hadoop/" title="分类于 Hadoop">Hadoop</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Hadoop/course-2/" title="分类于 Hadoop基础知识">Hadoop基础知识</a></div><span><a href="/2020/11/25/Hadoop/Hadoop/course-2/HDFS%E7%9A%84API%E6%93%8D%E4%BD%9C/" title="HDFS的API操作">HDFS的API操作</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Hadoop/" title="分类于 大数据应用">大数据应用</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Zookeeper/" title="分类于 Zookeeper">Zookeeper</a> <i class="ic i-angle-right"></i> <a href="/categories/Hadoop/Zookeeper/course-1/" title="分类于 Zookeeper基础知识">Zookeeper基础知识</a></div><span><a href="/2020/11/23/Hadoop/Zookeeper/course-1/Zookeeper%E7%9A%84API%E6%93%8D%E4%BD%9C/" title="Zookeeper的API操作">Zookeeper的API操作</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Andrésen @ Andrésen Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">76k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">1:09</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2020/11/26/Hadoop/Hadoop/course-2/Hadoop高可用集群搭建/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.4"></script></body></html><!-- rebuild by hrmmi -->