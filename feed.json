{
    "version": "https://jsonfeed.org/version/1",
    "title": "Andrésen",
    "description": "",
    "home_page_url": "https://methiony.work",
    "items": [
        {
            "id": "https://methiony.work/2020/11/24/Platform-construction/Haoop/course-2/Hadoop%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/",
            "url": "https://methiony.work/2020/11/24/Platform-construction/Haoop/course-2/Hadoop%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/",
            "title": "Hadoop基本介绍",
            "date_published": "2020-11-24T03:28:23.000Z",
            "content_html": "",
            "tags": []
        },
        {
            "id": "https://methiony.work/2020/11/23/Platform-construction/Zookeeper/course-1/Zookeeper%E7%9A%84API%E6%93%8D%E4%BD%9C/",
            "url": "https://methiony.work/2020/11/23/Platform-construction/Zookeeper/course-1/Zookeeper%E7%9A%84API%E6%93%8D%E4%BD%9C/",
            "title": "Zookeeper的API操作",
            "date_published": "2020-11-23T11:33:46.000Z",
            "content_html": "<h1 id=\"zookeeper的javaapi操作\"><a class=\"anchor\" href=\"#zookeeper的javaapi操作\">#</a> Zookeeper 的 javaAPI 操作</h1>\n<p>这里操作 Zookeeper 的 JavaAPI 使用的是 Zookeeper 客户端框架 Curator</p>\n<p>Curator 包含：</p>\n<p>curator-framework：对 zookeeper 的底层 api 的一些封装</p>\n<p>curator-recipes：封装了一些高级特性，如：Cache 事件监听、选举、分布式锁、分布式计数器等</p>\n<h2 id=\"1-创建java工程导入jar包\"><a class=\"anchor\" href=\"#1-创建java工程导入jar包\">#</a> 1、创建 Java 工程，导入 jar 包</h2>\n<p>创建 maven Java 工程，导入 jar 包</p>\n<h3 id=\"添加porn文件\"><a class=\"anchor\" href=\"#添加porn文件\">#</a> 添加 Porn 文件</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>dependencies<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>dependency<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>groupId<span class=\"token punctuation\">></span></span>org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>curator<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>groupId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>artifactId<span class=\"token punctuation\">></span></span>curator<span class=\"token operator\">-</span>framework<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>artifactId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>version<span class=\"token punctuation\">></span></span><span class=\"token number\">2.12</span><span class=\"token number\">.0</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>version<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>dependency<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>dependency<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>groupId<span class=\"token punctuation\">></span></span>org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>curator<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>groupId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>artifactId<span class=\"token punctuation\">></span></span>curator<span class=\"token operator\">-</span>recipes<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>artifactId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>version<span class=\"token punctuation\">></span></span><span class=\"token number\">2.12</span><span class=\"token number\">.0</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>version<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>dependency<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>dependency<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>groupId<span class=\"token punctuation\">></span></span>com<span class=\"token punctuation\">.</span>google<span class=\"token punctuation\">.</span>collections<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>groupId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>artifactId<span class=\"token punctuation\">></span></span>google<span class=\"token operator\">-</span>collections<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>artifactId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>version<span class=\"token punctuation\">></span></span><span class=\"token number\">1.0</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>version<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>dependency<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>dependency<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>groupId<span class=\"token punctuation\">></span></span>junit<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>groupId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>artifactId<span class=\"token punctuation\">></span></span>junit<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>artifactId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>version<span class=\"token punctuation\">></span></span>RELEASE<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>version<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>dependency<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>dependency<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>groupId<span class=\"token punctuation\">></span></span>org<span class=\"token punctuation\">.</span>slf4j<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>groupId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>artifactId<span class=\"token punctuation\">></span></span>slf4j<span class=\"token operator\">-</span>simple<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>artifactId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>version<span class=\"token punctuation\">></span></span><span class=\"token number\">1.7</span><span class=\"token number\">.25</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>version<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>dependency<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>dependencies<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>build<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>plugins<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>plugin<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>groupId<span class=\"token punctuation\">></span></span>org<span class=\"token punctuation\">.</span>apache<span class=\"token punctuation\">.</span>maven<span class=\"token punctuation\">.</span>plugins<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>groupId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>artifactId<span class=\"token punctuation\">></span></span>maven<span class=\"token operator\">-</span>compiler<span class=\"token operator\">-</span>plugin<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>artifactId<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>version<span class=\"token punctuation\">></span></span><span class=\"token number\">3.2</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>version<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>configuration<span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>source<span class=\"token punctuation\">></span></span><span class=\"token number\">1.8</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>source<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>target<span class=\"token punctuation\">></span></span><span class=\"token number\">1.8</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>target<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span>encoding<span class=\"token punctuation\">></span></span>UTF<span class=\"token operator\">-</span><span class=\"token number\">8</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>encoding<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>configuration<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>plugin<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>plugins<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>build<span class=\"token operator\">></span></pre></td></tr></table></figure><p>在 Java 工程的 src 目录下创建一个 Java 类</p>\n<h2 id=\"2-创建永久节点\"><a class=\"anchor\" href=\"#2-创建永久节点\">#</a> 2、创建永久节点</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">createZnode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 定制一个重试策略</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">RetryPolicy</span> retryPolicy <span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ExponentialBackoffRetry</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 获取一个客户端对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> connectionStr <span class=\"token operator\">=</span> <span class=\"token string\">\"192.168.2.128:2181,192.168.2.129:2181,192.168.2.130:2181\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">CuratorFramework</span> client <span class=\"token operator\">=</span> <span class=\"token class-name\">CuratorFrameworkFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">newClient</span><span class=\"token punctuation\">(</span>connectionStr<span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> retryPolicy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 开启客户端</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 创建节点</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">creatingParentsIfNeeded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CreateMode</span><span class=\"token punctuation\">.</span>PERSISTENT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"world\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 关闭客户端</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"3-创建临时节点\"><a class=\"anchor\" href=\"#3-创建临时节点\">#</a> 3、创建临时节点</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">createtmpZnode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 定制一个重试策略</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">RetryPolicy</span> retryPolicy <span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ExponentialBackoffRetry</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 获取一个客户端对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> connectionStr <span class=\"token operator\">=</span> <span class=\"token string\">\"192.168.2.128:2181,192.168.2.129:2181,192.168.2.130:2181\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">CuratorFramework</span> client <span class=\"token operator\">=</span> <span class=\"token class-name\">CuratorFrameworkFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">newClient</span><span class=\"token punctuation\">(</span>connectionStr<span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> retryPolicy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 开启客户端</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 创建节点</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">creatingParentsIfNeeded</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">withMode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CreateMode</span><span class=\"token punctuation\">.</span>EPHEMERAL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello3\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"world\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 休眠时间 5s</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// 关闭客户端</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"4-修改节点数据\"><a class=\"anchor\" href=\"#4-修改节点数据\">#</a> 4、修改节点数据</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setZnodeData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 定制一个重试策略</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">RetryPolicy</span> retryPolicy <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ExponentialBackoffRetry</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 获取一个客户端对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> connectionStr <span class=\"token operator\">=</span> <span class=\"token string\">\"192.168.2.128:2181,192.168.2.129:2181,192.168.2.130:2181\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">CuratorFramework</span> client <span class=\"token operator\">=</span> <span class=\"token class-name\">CuratorFrameworkFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">newClient</span><span class=\"token punctuation\">(</span>connectionStr<span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> retryPolicy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 开启客户端</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 修改节点数据</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"zookeeper\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 关闭客户端</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"5-查看节点数据\"><a class=\"anchor\" href=\"#5-查看节点数据\">#</a> 5、查看节点数据</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">getZnodeData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 定制一个重试策略</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">RetryPolicy</span> retryPolicy <span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ExponentialBackoffRetry</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 获取一个客户端对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> connectionStr <span class=\"token operator\">=</span> <span class=\"token string\">\"192.168.2.128:2181,192.168.2.129:2181,192.168.2.130:2181\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">CuratorFramework</span> client <span class=\"token operator\">=</span> <span class=\"token class-name\">CuratorFrameworkFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">newClient</span><span class=\"token punctuation\">(</span>connectionStr<span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> retryPolicy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 开启客户端</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 获取节点数据</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> bytes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">byte</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            bytes <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// 关闭客户端</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"6-删除节点\"><a class=\"anchor\" href=\"#6-删除节点\">#</a> 6、删除节点</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">delZnode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 定制一个重试策略</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">RetryPolicy</span> retryPolicy <span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ExponentialBackoffRetry</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 获取一个客户端对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> connectionStr <span class=\"token operator\">=</span> <span class=\"token string\">\"192.168.2.128:2181,192.168.2.129:2181,192.168.2.130:2181\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">CuratorFramework</span> client <span class=\"token operator\">=</span> <span class=\"token class-name\">CuratorFrameworkFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">newClient</span><span class=\"token punctuation\">(</span>connectionStr<span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> retryPolicy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 开启客户端</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 删除节点</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 关闭客户端</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"7-设置watch机制\"><a class=\"anchor\" href=\"#7-设置watch机制\">#</a> 7、设置 watch 机制</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token annotation punctuation\">@Test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">watchZnode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 定制一个重试策略</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">RetryPolicy</span> retryPolicy <span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ExponentialBackoffRetry</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 获取一个客户端对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">String</span> connectionStr <span class=\"token operator\">=</span> <span class=\"token string\">\"192.168.2.128:2181,192.168.2.129:2181,192.168.2.130:2181\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">CuratorFramework</span> client <span class=\"token operator\">=</span> <span class=\"token class-name\">CuratorFrameworkFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">newClient</span><span class=\"token punctuation\">(</span>connectionStr<span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8000</span><span class=\"token punctuation\">,</span> retryPolicy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// 开启客户端</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        client<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 设置节点的 cache, 指定监控的节点</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">TreeCache</span> treeCache <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TreeCache</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// 自定义一个监听器</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        treeCache<span class=\"token punctuation\">.</span><span class=\"token function\">getListenable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">TreeCacheListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">childEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CuratorFramework</span> curatorFramework<span class=\"token punctuation\">,</span> <span class=\"token class-name\">TreeCacheEvent</span> treeCacheEvent<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token class-name\">ChildData</span> data <span class=\"token operator\">=</span> treeCacheEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>treeCacheEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                        <span class=\"token keyword\">case</span> NODE_ADDED<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"监控到有新增节点\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                        <span class=\"token keyword\">case</span> NODE_REMOVED<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"监控到节点被移除\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                        <span class=\"token keyword\">case</span> NODE_UPDATED<span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"监控到节点被更新\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                        <span class=\"token keyword\">default</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// 开始监听</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            treeCache<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token comment\">// 设置延时</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">500000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": []
        },
        {
            "id": "https://methiony.work/2020/11/23/Platform-construction/Zookeeper/course-1/Zookeeper%E7%9A%84watch%E6%9C%BA%E5%88%B6/",
            "url": "https://methiony.work/2020/11/23/Platform-construction/Zookeeper/course-1/Zookeeper%E7%9A%84watch%E6%9C%BA%E5%88%B6/",
            "title": "Zookeeper的watch和选举机制",
            "date_published": "2020-11-23T10:50:38.000Z",
            "content_html": "<h1 id=\"zookeeper的watch和选举机制\"><a class=\"anchor\" href=\"#zookeeper的watch和选举机制\">#</a> Zookeeper 的 watch 和选举机制</h1>\n<h2 id=\"1-选举机制\"><a class=\"anchor\" href=\"#1-选举机制\">#</a> 1、选举机制</h2>\n<p>半数机制：集群中半数以上机器存活，集群可用。所以 zookeeper 适合安装奇数台服务器。Zookeeper 工作时，是有一个节点为 Leader，其他则为 Follower，Leader 是通过内部的选举机制临时产生的。</p>\n<p>假设有五台服务器组成的 Zookeeper 集群，它们的 id 为 1-5，没有历史数据，在存放数据量这一点上，都是一样的。假设这些服务器依序启动，它们之间会通过选举机制选出 Leader</p>\n<h3 id=\"过程详解\"><a class=\"anchor\" href=\"#过程详解\">#</a> 过程详解：</h3>\n<p><em>服务器 1 启动</em>，发起一次选举。服务器 1 投自己一票。此时服务器 1, 票数一票，不够半数以上（3 票），选举无法完成，服务器 1 状态保持为 LOOKING；</p>\n<p><em>服务器 2 启动</em>，再发起一次选举。服务器 1 和 2 分别投自己一票并交换选票信息：此时服务器 1 发现服务器 2 的 ID 比自己目前投票推举的（服务器 1）大，更改选票为推举服务器 2。此时服务器 1 票数 0 票，服务器 2 票数 2 票，没有半数以上结果，选举无法完成，服务器 1，2 状态保持 LOOKING</p>\n<p><em>服务器 3 启动</em>，发起一次选举。此时服务器 1 和 2 都会更改选票为服务器 3。此次投票结果：服务器 1 为 0 票，服务器 2 为 0 票，服务器 3 为 3 票。此时服务器 3 的票数已经超过半数，服务器 3 当选 Leader。服务器 1，2 更改状态为 FOLLOWING，服务器 3 更改状态为 LEADING；</p>\n<p><em>服务器 4 启动</em>，发起一次选举。此时服务器 1，2，3 已经不是 LOOKING 状态，不会更改选票信息。交换选票信息结果：服务器 3 为 3 票，服务器 4 为 1 票。此时服务器 4 服从多数，更改选票信息为服务器 3，并更改状态为 FOLLOWING；</p>\n<p><em>服务器 5 启动</em>，同服务器 4 一样。</p>\n<h2 id=\"1-watch机制\"><a class=\"anchor\" href=\"#1-watch机制\">#</a> 1、watch 机制</h2>\n<p>类似于数据库中的触发器，对某个 Znode 设置 Watcher, 当 Znode 发生变化的时候，WatchManager 会调用对应的 Watcher</p>\n<p>当 Znode 发生删除、修改、创建，子节点发生改变的时候，对应的 Watcher 会得到通知</p>\n<h3 id=\"watcher的特点\"><a class=\"anchor\" href=\"#watcher的特点\">#</a> watcher 的特点</h3>\n<p><strong>一次性触发</strong>：一个 watcher 只会被触发一次，如果需要继续监听，则需要再次添加 watcher</p>\n<p><strong>事件封装</strong>：watcher 得到的事件是被封装过的，包括三个内容 keeperState,evenType,path</p>\n<h4 id=\"常见的监听\"><a class=\"anchor\" href=\"#常见的监听\">#</a> 常见的监听：</h4>\n<p>监听节点数据的变化： <code>get path [watch]</code></p>\n<p>监听子节点增减的变化： <code>ls path [watch]</code></p>\n",
            "tags": []
        },
        {
            "id": "https://methiony.work/2020/11/23/Platform-construction/Zookeeper/course-1/Zookeeper%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/",
            "url": "https://methiony.work/2020/11/23/Platform-construction/Zookeeper/course-1/Zookeeper%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/",
            "title": "Zookeeper基础知识",
            "date_published": "2020-11-23T06:50:40.000Z",
            "content_html": "<h1 id=\"zookeeper基础知识\"><a class=\"anchor\" href=\"#zookeeper基础知识\">#</a> Zookeeper 基础知识</h1>\n<h2 id=\"1-zookeepr的数据类型\"><a class=\"anchor\" href=\"#1-zookeepr的数据类型\">#</a> 1、zookeepr 的数据类型</h2>\n<h3 id=\"与标准文件系统相同之处\"><a class=\"anchor\" href=\"#与标准文件系统相同之处\">#</a> 与标准文件系统相同之处</h3>\n<p>Zookeeper 的数据类型，在结构上拥有一个层次的命名空间，和标准文件系统非常相似，都是采用树形层次结构</p>\n<p>Zookeeper 树中的每个节点称为一个 Znode, 每个节点可以拥有子节点</p>\n<h3 id=\"与标准文件系统不同之处\"><a class=\"anchor\" href=\"#与标准文件系统不同之处\">#</a> 与标准文件系统不同之处</h3>\n<p>Znode 具有文件和目录两种特点。既有文件的数据功能，又有目录作为路径标识的功能，并可以具有子 Znode。znode 具有增、删、改、查等操作</p>\n<p>Znode 存储数据大小有限制。它用来管理调度数据，数据通常以 kb 为单位，数据大小至多 1M，通常小于此值</p>\n<p>Znode 通过路径引用，且为绝对路径，因此为 &quot;/&quot; 开头</p>\n<p>Znode 由 3 部分组成。stat: 状态信息，描述版本、权限等信息\tdata：与该 znode 关联的数据\tchildren：该 znode 下的子节点</p>\n<h2 id=\"znode节点类型\"><a class=\"anchor\" href=\"#znode节点类型\">#</a> Znode 节点类型</h2>\n<p>节点类型在创建时被确定，不能改变</p>\n<p>1、临时节点：在使用期间存在，会话结束后自动删除。不允许拥有子节点</p>\n<p>2、永久节点：只能手动删除，允许拥有子节点</p>\n<p>3、节点具有序列化特性，如果在创建时指定，该 znode 后面会自动追加一个 10 位数字的序列号</p>\n<p>四种类型的 Znode 节点</p>\n<table>\n<thead>\n<tr>\n<th>PERSISTENT:</th>\n<th>永久节点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>EPHEMERAL:</td>\n<td>临时节点</td>\n</tr>\n<tr>\n<td>PERSISTENT_SEQUENTIAL</td>\n<td>永久节点、序列化</td>\n</tr>\n<tr>\n<td>EPHEMERAL_SEQUENTIAL</td>\n<td>临时节点、序列化</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"zookeeper的shell客户端操作\"><a class=\"anchor\" href=\"#zookeeper的shell客户端操作\">#</a> Zookeeper 的 Shell 客户端操作</h2>\n<h3 id=\"登录zookeeper客户端\"><a class=\"anchor\" href=\"#登录zookeeper客户端\">#</a> 登录 Zookeeper 客户端</h3>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>bin<span class=\"token operator\">/</span>zkCli<span class=\"token punctuation\">.</span>sh <span class=\"token operator\">-</span>server master:2181</pre></td></tr></table></figure><h3 id=\"操作实例\"><a class=\"anchor\" href=\"#操作实例\">#</a> 操作实例</h3>\n<p>列出 Path 下的所有 Znode</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ls</span> <span class=\"token operator\">/</span></pre></td></tr></table></figure><p>创建永久节点</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>create <span class=\"token operator\">/</span>hello world</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>create <span class=\"token operator\">/</span>hello<span class=\"token operator\">/</span>hello1 world</pre></td></tr></table></figure><p>创建临时节点</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>create <span class=\"token operator\">-</span>e <span class=\"token operator\">/</span>hello world</pre></td></tr></table></figure><p>创建永久序列化节点</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>create <span class=\"token operator\">-</span>s <span class=\"token operator\">/</span>hello world</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>create <span class=\"token operator\">-</span>s <span class=\"token operator\">/</span>hello<span class=\"token operator\">/</span>hello1 world</pre></td></tr></table></figure><p>创建临时序列化节点</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>create <span class=\"token operator\">-</span>e <span class=\"token operator\">-</span>s <span class=\"token operator\">/</span>hello world</pre></td></tr></table></figure><p>修改节点数据</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">set</span> <span class=\"token operator\">/</span>hello zookeeper</pre></td></tr></table></figure><p>删除节点，如果有子 znode 则该命令无效</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>delete <span class=\"token operator\">/</span>hello</pre></td></tr></table></figure><p>删除节点，如果有子 znode 则递归删除</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rmr <span class=\"token operator\">/</span>hello</pre></td></tr></table></figure><p>列出历史记录</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>histroy</pre></td></tr></table></figure><h3 id=\"操作命令\"><a class=\"anchor\" href=\"#操作命令\">#</a> 操作命令</h3>\n<p>path: 指 / Znode、data:znode 数据、acl: 权限、watch: 观察</p>\n<table>\n<thead>\n<tr>\n<th>命令</th>\n<th>说明</th>\n<th>参数</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>create [-s] [-e] path data acl</td>\n<td>创建 znode</td>\n<td>-s 指顺序节点，-e 指临时节点</td>\n</tr>\n<tr>\n<td>ls  path  [watch]</td>\n<td>列出 path 下所有子 znode</td>\n<td></td>\n</tr>\n<tr>\n<td>get  path  [watch]</td>\n<td>获取 path 对应的 znode 的数据和属性</td>\n<td></td>\n</tr>\n<tr>\n<td>ls2  path  [watch]</td>\n<td>查看 path 所有子 znode 和子 znode 属性</td>\n<td></td>\n</tr>\n<tr>\n<td>set  path  data</td>\n<td>更新节点</td>\n<td></td>\n</tr>\n<tr>\n<td>delete  path</td>\n<td>删除节点，如果有子 znode 则该命令无效</td>\n<td></td>\n</tr>\n<tr>\n<td>rmr  path</td>\n<td>删除节点，如果有子 znode 则递归删除</td>\n<td></td>\n</tr>\n<tr>\n<td>setquota  -n|-b  val  path</td>\n<td>修改 znode 配额</td>\n<td>-n 设置子节点最大个数，-b 设置节点数据最大长度</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"节点属性\"><a class=\"anchor\" href=\"#节点属性\">#</a> 节点属性</h3>\n<p><img data-src=\"C:%5CUsers%5CMethiony%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20201123160350874.png\" alt=\"\" /></p>\n<p>cZxid:znode 创建的事务 id</p>\n<p>ctime: 节点创建时的时间戳</p>\n<p>mZxid:Znode 被修改的事务 id, 每次对 znode 的修改都会更新 mZxid, 可以确定更新操作的顺序，如果 zxid1 小于 zxid2，说明 zxid1 操作先于 zxid2 发生，zxid 对于整个 zookeeper 都是唯一的</p>\n<p>mtime: 节点最新一次更新发生时的时间戳</p>\n<p>cversion: 子节点的版本号。当 znode 子节点有变化时，值会增加 1</p>\n<p>dataVersion: 数据版本号，每次对节点进行 set 操作，值会增加 1，避免了数据更新的顺序问题</p>\n<p>aclVersion:ACL 的版本号</p>\n<p>ephemeralOwner: 如果节点为临时节点，ephemeralOwner 值表示与该节点绑定的 session id。如果不是，ephemeralOwner 值为 0</p>\n<h2 id=\"\"><a class=\"anchor\" href=\"#\">#</a> </h2>\n",
            "tags": []
        },
        {
            "id": "https://methiony.work/2020/11/21/Platform-construction/Haoop/course-2/Hadoop%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/",
            "url": "https://methiony.work/2020/11/21/Platform-construction/Haoop/course-2/Hadoop%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/",
            "title": "Hadoop分布式集群搭建",
            "date_published": "2020-11-21T11:19:50.000Z",
            "content_html": "<h1 id=\"hadoop分布式集群搭建\"><a class=\"anchor\" href=\"#hadoop分布式集群搭建\">#</a> Hadoop 分布式集群搭建</h1>\n<h2 id=\"1-环境准备\"><a class=\"anchor\" href=\"#1-环境准备\">#</a> 1、环境准备</h2>\n<p>首先准备了三台虚拟机（为了避免环境的干扰，都是新建的虚拟机），分别分配了 1G 内存、20G 硬盘、2 核 CPU，然后安装了 CentOS-7-x86_64-DVD-2009 操作系统，并配置了静态 IP 地址。</p>\n<p><strong>集群规划：</strong></p>\n<p>搭建的是 NameNode 与 ResourceManager 单节点架构。节点具体分别如下：</p>\n<table>\n<thead>\n<tr>\n<th>服务器名称</th>\n<th>IP 地址</th>\n<th>NameNode</th>\n<th>SecondaryNameNode</th>\n<th>dataNode</th>\n<th>ResourceManager</th>\n<th>NodeManager</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>master</td>\n<td>192.168.2.128</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>node01</td>\n<td>192.168.2.129</td>\n<td>否</td>\n<td>否</td>\n<td>是</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>node02</td>\n<td>192.168.2.130</td>\n<td>否</td>\n<td>否</td>\n<td>是</td>\n<td>否</td>\n<td>是</td>\n</tr>\n</tbody>\n</table>\n<p><strong>文件系统核心模块：</strong><br />\nNameNode：集群当中的主节点，主要用于管理集群当中的各种数据<br />\n secondaryNameNode：主要能用于 hadoop 当中元数据信息的辅助管理<br />\n DataNode：集群当中的从节点，主要用于存储集群当中的各种数据<br />\n<strong>数据计算核心模块：</strong><br />\nResourceManager：接收用户的计算请求任务，并负责集群的资源分配<br />\n NodeManager：负责执行主节点 APPmaster 分配的任务</p>\n<h2 id=\"2-环境配置\"><a class=\"anchor\" href=\"#2-环境配置\">#</a> 2、环境配置</h2>\n<p>1、关闭防火墙</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@localhost ~]</span><span class=\"token comment\"># systemctl stop firewalld.service </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#关闭防火墙</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token namespace\">[root@localhost ~]</span><span class=\"token comment\"># systemctl disable firewalld.service </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#禁止开机启动</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token namespace\">[root@localhost ~]</span><span class=\"token operator\">*</span><span class=\"token comment\"># firewall-cmd --state </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#查看防火墙状态</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>not running</pre></td></tr></table></figure><p>2、设置主机名称</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#在 192.168.2.128 机器上执行 * </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token namespace\">[root@localhost ~]</span><span class=\"token operator\">*</span><span class=\"token comment\"># hostnamectl set-hostname  master</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">*</span><span class=\"token comment\">#在 192.168.2.129 机器上执行 * </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token namespace\">[root@localhost ~]</span><span class=\"token operator\">*</span><span class=\"token comment\"># hostnamectl set-hostname node01</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">*</span><span class=\"token comment\">#在 192.168.2.130 机器上执行 * </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token namespace\">[root@localhost ~]</span><span class=\"token operator\">*</span><span class=\"token comment\"># hostnamectl set-hostname node02</span></pre></td></tr></table></figure><p>3、三台虚拟机重启</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#在 192.168.2.128 机器上执行 * </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token namespace\">[root@localhost ~]</span><span class=\"token comment\"># reboot</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">*</span><span class=\"token comment\">#在 192.168.2.129 机器上执行 * </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token namespace\">[root@localhost ~]</span><span class=\"token comment\"># reboot</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">*</span><span class=\"token comment\">#在 192.168.2.130 机器上执行 * </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token namespace\">[root@localhost ~]</span><span class=\"token comment\"># reboot</span></pre></td></tr></table></figure><p>4、关闭 selinux</p>\n<p>进入到 /etc/selinux/config 文件，将 SELINUX=enforcing 改为 SELINUX=disabled。</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master ~]</span><span class=\"token comment\">#  vi  /etc/selinux/config</span></pre></td></tr></table></figure><p>5、设置免密登录</p>\n<p>首先在 master 主机上使用 ssh-keygen 命令来生成秘钥，一路按回车键</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#ssh-keygen -t rsa</span></pre></td></tr></table></figure><p>通过 ssh-copy-id 命令设置免密钥登录<br />\n其中，master、node01、node02 表示需要设置免密登录的服务器地址。</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ssh<span class=\"token operator\">-</span><span class=\"token function\">copy-id</span> <span class=\"token operator\">-</span>i ~<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span>ssh<span class=\"token operator\">/</span>id_rsa<span class=\"token punctuation\">.</span>pub root@192<span class=\"token punctuation\">.</span>168<span class=\"token punctuation\">.</span>2<span class=\"token punctuation\">.</span>128</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ssh<span class=\"token operator\">-</span><span class=\"token function\">copy-id</span> <span class=\"token operator\">-</span>i ~<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span>ssh<span class=\"token operator\">/</span>id_rsa<span class=\"token punctuation\">.</span>pub root@192<span class=\"token punctuation\">.</span>168<span class=\"token punctuation\">.</span>2<span class=\"token punctuation\">.</span>129</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ssh<span class=\"token operator\">-</span><span class=\"token function\">copy-id</span> <span class=\"token operator\">-</span>i ~<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span>ssh<span class=\"token operator\">/</span>id_rsa<span class=\"token punctuation\">.</span>pub root@192<span class=\"token punctuation\">.</span>168<span class=\"token punctuation\">.</span>2<span class=\"token punctuation\">.</span>130</pre></td></tr></table></figure><h2 id=\"3-安装jdk\"><a class=\"anchor\" href=\"#3-安装jdk\">#</a> 3、安装 JDK</h2>\n<p>在 master 中新建目录 /opt/bigdata/, 此目录下存放 hadoop 大数据所需要的环境包 (jdk 和 hadoop).</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#mkdir /opt/bigdata</span></pre></td></tr></table></figure><p>1、把下载好的 jdk-8u271-linux-x64.tar.gz 包和 hadoop-3.1.4.tar.gz 上传至 master 主机中，JDK 是安装 Hadoop 的基础环境，所以需要优先安装好 JDK 环境</p>\n<p>2、解压 jdk 并复制到 /opt/bigdata 目录下</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#tar -zxvf jdk-8u271-linux-x64.tar.gz -C</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata</pre></td></tr></table></figure><p>3、配置环境变量 (/etc/profile)</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#vi /etc/profile</span></pre></td></tr></table></figure><p>添加</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>export JAVA_HOME=<span class=\"token operator\">/</span>export<span class=\"token operator\">/</span>servers<span class=\"token operator\">/</span>jdk1<span class=\"token punctuation\">.</span>8<span class=\"token punctuation\">.</span>0_271 </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>export PATH=:<span class=\"token variable\">$JAVA_HOME</span><span class=\"token operator\">/</span>bin:<span class=\"token variable\">$PATH</span></pre></td></tr></table></figure><p>执行下面命令，让环境变量生效</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#source/etc/profile</span></pre></td></tr></table></figure><p>验证 jdk 安装是否成功</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#java -version</span></pre></td></tr></table></figure><h2 id=\"4-安装hadoop\"><a class=\"anchor\" href=\"#4-安装hadoop\">#</a> 4、安装 hadoop</h2>\n<p>1、解压 hadoop，并把解压文件复制到 /opt/bigdata 目录中</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#tar -zxvf hadoop-3.1.4.tar.gz -C /opt/bigdata</span></pre></td></tr></table></figure><p>2、配置环境变量 (/etc/profile)</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#vi /etc/profile</span></pre></td></tr></table></figure><p>添加</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>export HADOOP_HOME=<span class=\"token operator\">/</span>export<span class=\"token operator\">/</span>servers<span class=\"token operator\">/</span>hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>export PATH=:<span class=\"token variable\">$HADOOP_HOME</span><span class=\"token operator\">/</span>bin:<span class=\"token variable\">$HADOOP_HOME</span><span class=\"token operator\">/</span>sbin:<span class=\"token variable\">$PATH</span></pre></td></tr></table></figure><p>执行下面命令，让环境变量生效</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#source/etc/profile</span></pre></td></tr></table></figure><p>3、修改 hadoop 的配置文件</p>\n<p>进入需改文件的目录</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#cd /opt/bigdata/hadoop-3.1.4/etc/hadoop</span></pre></td></tr></table></figure><p>需要修改的文件</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>core<span class=\"token operator\">-</span>site<span class=\"token punctuation\">.</span>xml\thadoop<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>sh\thdfs<span class=\"token operator\">-</span>site<span class=\"token punctuation\">.</span>xml\t</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mapred<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>sh\tmapred<span class=\"token operator\">-</span>site<span class=\"token punctuation\">.</span>xml\tyarn<span class=\"token operator\">-</span>site<span class=\"token punctuation\">.</span>xml</pre></td></tr></table></figure><p>首先，修改 core-site.xml 文件，在 &lt;configuration&gt; 元素中添加相应的配置文件</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span> \t</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">&lt;!--  指定集群的文件系统类型：分布式文件系统 --></span> \t</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span> \t\t</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>fs.default.name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span> \t\t</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 因为前面已经配置了服务器名称映射 IP，所以这里可以使用服务器名称进行配置 --></span> \t\t</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>hdfs://master:8020<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span> \t</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">&lt;!--  指定临时文件存储目录 --></span> \t</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>hadoop.tmp.dir<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span> \t\t\t\t\t     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>/opt/bigdata/hadoop3.1.4/hadoopDatas/tempDatas<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span> \t</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">&lt;!--  缓冲区大小，实际工作中根据服务器性能动态调整 --></span> \t</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span> \t\t</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>io.file.buffer.size<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span> \t\t</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>4096<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span> \t</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span>  \t</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token comment\">&lt;!--  开启 hdfs 的垃圾桶机制，删除掉的数据可以从垃圾桶中回收，单位分钟 --></span> \t</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>fs.trash.interval<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>10080<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span> \t</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>其次，修改 hdfs-site.xml 文件，在 &lt;configuration&gt; 元素中添加相应的配置文件</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>dfs.namenode.secondary.http-address<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>master:50090<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 指定 namenode 的访问地址和端口 --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>dfs.namenode.http-address<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>master:50070<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 指定 namenode 元数据的存放位置 --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>dfs.namenode.name.dir<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>file:///opt/bigdata/hadoop-3.1.4/hadoopDatas/namenodeDatas,file:///opt/bigdata/hadoop-3.1.4/hadoopDatas/namenodeDatas2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token comment\">&lt;!--  定义 dataNode 数据存储的节点位置，实际工作中，一般先确定磁盘的挂载目录，然后多个目录用，进行分割  --></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>dfs.datanode.data.dir<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>file:///opt/bigdata/hadoop-3.1.4/hadoopDatas/datanodeDatas,file:///opt/bigdata/hadoop-3.1.4/hadoopDatas/datanodeDatas2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 指定 namenode 日志文件的存放目录 --></span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>dfs.namenode.edits.dir<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>file:///opt/bigdata/hadoop-3.1.4/hadoopDatas/nn/edits<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>dfs.namenode.checkpoint.dir<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>file:///opt/bigdata/hadoop-3.1.4/hadoopDatas/snn/name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>dfs.namenode.checkpoint.edits.dir<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>file:///opt/bigdata/hadoop-3.1.4/hadoopDatas/dfs/snn/edits<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 文件切片的副本个数 --></span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>dfs.replication<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 设置 HDFS 的文件权限 --></span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>dfs.permissions<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 设置一个文件切片的大小：128M--></span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>dfs.blocksize<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>134217728<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>然后，修改 yarn-site.xml 文件，在 &lt;configuration&gt; 元素中添加相应的配置文件</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 配置 yarn 主节点的位置 --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>yarn.resourcemanager.hostname<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>master<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>yarn.nodemanager.aux-services<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>mapreduce_shuffle<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 开启日志聚合功能 --></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>yarn.log-aggregation-enable<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 设置聚合日志在 hdfs 上的保存时间 --></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>yarn.log-aggregation.retain-seconds<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>604800<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 设置 yarn 集群的内存分配方案 --></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span>    </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>yarn.nodemanager.resource.memory-mb<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span>    </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>20480<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span>  </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        \t <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>yarn.scheduler.minimum-allocation-mb<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>         \t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>2048<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>yarn.nodemanager.vmem-pmem-ratio<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>2.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>然后，修改 mapred-site.xml 文件，在 &lt;configuration&gt; 元素中添加相应的配置文件</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 开启 MapReduce 小任务模式 --></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>mapreduce.job.ubertask.enable<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 设置历史任务的主机和端口 --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>mapreduce.jobhistory.address<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>master:10020<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token comment\">&lt;!-- 设置网页访问历史任务的主机和端口 --></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>mapreduce.jobhistory.webapp.address<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>value</span><span class=\"token punctuation\">></span></span>master:19888<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>value</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>property</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>然后，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1oYWRvb3AtZW52LXl1NnA1NHIwbmE1NjF0LnNo\">分别修改 hadoop-env.sh</span>、mapred-env.sh 文件</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master hadoop]</span><span class=\"token comment\">#vi hadoop-env.sh</span></pre></td></tr></table></figure><figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master hadoop]</span><span class=\"token comment\">#vi mapred-env.sh</span></pre></td></tr></table></figure><p>添加 Java 环境变量</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>export JAVA_HOME=<span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>jdk1<span class=\"token punctuation\">.</span>8<span class=\"token punctuation\">.</span>0_271</pre></td></tr></table></figure><p>最后，修改集群配置文件 slaves（没有则新建）</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master hadoop]</span><span class=\"token comment\">#vi slaves</span></pre></td></tr></table></figure><p>添加</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>master</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>node01</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>node02</pre></td></tr></table></figure><p>4、创建 hadoop 需要的文件目录</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mkdir <span class=\"token operator\">-</span>p <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4<span class=\"token operator\">/</span>hadoopDatas<span class=\"token operator\">/</span>tempDatas</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mkdir <span class=\"token operator\">-</span>p <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4<span class=\"token operator\">/</span>hadoopDatas<span class=\"token operator\">/</span>namenodeDatas</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>mkdir <span class=\"token operator\">-</span>p <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4<span class=\"token operator\">/</span>hadoopDatas<span class=\"token operator\">/</span>namenodeDatas2</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>mkdir <span class=\"token operator\">-</span>p <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4<span class=\"token operator\">/</span>hadoopDatas<span class=\"token operator\">/</span>datanodeDatas</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>mkdir <span class=\"token operator\">-</span>p <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4<span class=\"token operator\">/</span>hadoopDatas<span class=\"token operator\">/</span>datanodeDatas2 </pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>mkdir <span class=\"token operator\">-</span>p <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4<span class=\"token operator\">/</span>hadoopDatas<span class=\"token operator\">/</span>nn<span class=\"token operator\">/</span>edits</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>mkdir <span class=\"token operator\">-</span>p <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4<span class=\"token operator\">/</span>hadoopDatas<span class=\"token operator\">/</span>snn<span class=\"token operator\">/</span>name</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>mkdir <span class=\"token operator\">-</span>p <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4<span class=\"token operator\">/</span>hadoopDatas<span class=\"token operator\">/</span>dfs<span class=\"token operator\">/</span>snn<span class=\"token operator\">/</span>edits</pre></td></tr></table></figure><h2 id=\"5-分发jdk-hadoop到node01-node02\"><a class=\"anchor\" href=\"#5-分发jdk-hadoop到node01-node02\">#</a> 5、分发 jdk、hadoop 到 node01、node02</h2>\n<p>首先进入 jdk、hadoop 的安装目录</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master hadoop]</span><span class=\"token comment\">#cd /opt/bigdata</span></pre></td></tr></table></figure><p>然后分发 jdk，分别到 node01、node02</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>scp <span class=\"token operator\">-</span>r jdk1<span class=\"token punctuation\">.</span>8<span class=\"token punctuation\">.</span>0_271 node01:<span class=\"token variable\">$PWD</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>scp <span class=\"token operator\">-</span>r jdk1<span class=\"token punctuation\">.</span>8<span class=\"token punctuation\">.</span>0_271 node02:<span class=\"token variable\">$PWD</span></pre></td></tr></table></figure><p>分发 Hadoop，分别到 node01、node02</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>scp <span class=\"token operator\">-</span>r hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4 node01:<span class=\"token variable\">$PWD</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>scp <span class=\"token operator\">-</span>r hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4 node02:<span class=\"token variable\">$PWD</span></pre></td></tr></table></figure><p>分发 master 已经配置好的环境变量文件到 node01、node02 (需要进入到根目录)</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>scp <span class=\"token operator\">-</span>r <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>profile root@node01:<span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>profile </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>scp <span class=\"token operator\">-</span>r <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>profile root@node02:<span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>profile</pre></td></tr></table></figure><p>执行下面命令，让环境变量生效</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@node01~]</span><span class=\"token comment\">#source/etc/profile</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token namespace\">[root@node02~]</span><span class=\"token comment\">#source/etc/profile</span></pre></td></tr></table></figure><p>检查是否生效</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@node01~]</span><span class=\"token comment\">#java -version</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token namespace\">[root@node02~]</span><span class=\"token comment\">#java -version</span></pre></td></tr></table></figure><h2 id=\"6-启动集群\"><a class=\"anchor\" href=\"#6-启动集群\">#</a> 6、启动集群</h2>\n<p>首先，在 master 主机进行格式化（首次需要执行）</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cd  <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>hadoop<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>1<span class=\"token punctuation\">.</span>4<span class=\"token operator\">/</span> <span class=\"token comment\">#首先进入 hadoop 根目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>bin<span class=\"token operator\">/</span>hdfs namenode <span class=\"token operator\">-</span>format <span class=\"token comment\">#执行格式化命令</span></pre></td></tr></table></figure><p>然后，启动 hdfs 集群</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sbin<span class=\"token operator\">/</span><span class=\"token function\">start-dfs</span><span class=\"token punctuation\">.</span>sh</pre></td></tr></table></figure><p>再启动 yarn 集群</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sbin<span class=\"token operator\">/</span><span class=\"token function\">start-yarn</span><span class=\"token punctuation\">.</span>sh</pre></td></tr></table></figure><p>最后，启动 historyserver，查看历史完成的任务</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>sbin<span class=\"token operator\">/</span>mr<span class=\"token operator\">-</span>jobhistory<span class=\"token operator\">-</span>daemon<span class=\"token punctuation\">.</span>sh <span class=\"token function\">start</span> historyserver</pre></td></tr></table></figure><p>使用 jps 查看进程</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master~]</span><span class=\"token comment\">#jps</span></pre></td></tr></table></figure><h2 id=\"7-查看可视化界面验证启动是否成功\"><a class=\"anchor\" href=\"#7-查看可视化界面验证启动是否成功\">#</a> 7、查看可视化界面，验证启动是否成功</h2>\n<p>1、首先访问：<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMi4xMjg6NTAwNzAvZXhwbG9yZXIuaHRtbCMvJUVGJUJDJThDJUU3JTk0JUE4JUU2JTlEJUE1JUU2JTlGJUE1JUU3JTlDJThCaGRmcw==\">http://192.168.2.128:50070/explorer.html#/，用来查看 hdfs</span></p>\n<p>2、然后访问：<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMi4xMjg6ODA4OC9jbHVzdGVyJUVGJUJDJThDJUU2JTlGJUE1JUU3JTlDJThCeWFybiVFOSU5QiU4NiVFNyVCRSVBNA==\">http://192.168.2.128:8088/cluster，查看 yarn 集群</span></p>\n<p>3、最后访问：<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMi4xMjg6MTk4ODgvam9iaGlzdG9yeSVFRiVCQyU4QyVFNiU5RiVBNSVFNyU5QyU4QiVFNSU4RSU4NiVFNSU4RiVCMiVFNSVBRSU4QyVFNiU4OCU5MCVFNyU5QSU4NCVFNCVCQiVCQiVFNSU4QSVBMQ==\">http://192.168.2.128:19888/jobhistory，查看历史完成的任务</span></p>\n<p>如果都有页面表示搭建成功！</p>\n",
            "tags": []
        },
        {
            "id": "https://methiony.work/2020/11/21/Platform-construction/Zookeeper/course-1/Zookeeper%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/",
            "url": "https://methiony.work/2020/11/21/Platform-construction/Zookeeper/course-1/Zookeeper%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA/",
            "title": "Zookeeper快速搭建",
            "date_published": "2020-11-21T09:40:19.000Z",
            "content_html": "<h1 id=\"zookeeper快速搭建\"><a class=\"anchor\" href=\"#zookeeper快速搭建\">#</a> ZooKeeper 快速搭建</h1>\n<h2 id=\"1-zookeeper的安装部署\"><a class=\"anchor\" href=\"#1-zookeeper的安装部署\">#</a> 1、Zookeeper 的安装部署</h2>\n<h3 id=\"拷贝zookeeper安装包到linux系统下\"><a class=\"anchor\" href=\"#拷贝zookeeper安装包到linux系统下\">#</a> 拷贝 Zookeeper 安装包到 Linux 系统下</h3>\n<h3 id=\"解压到指定目录\"><a class=\"anchor\" href=\"#解压到指定目录\">#</a> 解压到指定目录</h3>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master]</span>$ tar <span class=\"token operator\">-</span>zxvf zookeeper<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>6<span class=\"token punctuation\">.</span>2<span class=\"token punctuation\">.</span>tar<span class=\"token punctuation\">.</span>gz <span class=\"token operator\">-</span>C <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span></pre></td></tr></table></figure><h3 id=\"配置修改\"><a class=\"anchor\" href=\"#配置修改\">#</a> 配置修改</h3>\n<h4 id=\"optbigdatazookeeper-362conf这个路径下的zoo_samplecfg修改为zoocfg如果存在zoocfg文件则不需要拷贝zoo_samplecfg\"><a class=\"anchor\" href=\"#optbigdatazookeeper-362conf这个路径下的zoo_samplecfg修改为zoocfg如果存在zoocfg文件则不需要拷贝zoo_samplecfg\">#</a> /opt/bigdata/zookeeper-3.6.2/conf 这个路径下的 zoo_sample.cfg 修改为 zoo.cfg (如果存在 zoo.cfg 文件则不需要拷贝 zoo_sample.cfg)</h4>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master]</span>$ <span class=\"token function\">mv</span> zoo_sample<span class=\"token punctuation\">.</span>cfg zoo<span class=\"token punctuation\">.</span>cfg</pre></td></tr></table></figure><p>打开 zoo.cfg 文件，修改 dataDir 路径</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>dataDir=<span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>zookeeper<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>6<span class=\"token punctuation\">.</span>2<span class=\"token operator\">/</span>zkData</pre></td></tr></table></figure><p>文件内容末尾添加内容</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>server<span class=\"token punctuation\">.</span>1=master:2888:3888</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>server<span class=\"token punctuation\">.</span>2=node1:2888:3888</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server<span class=\"token punctuation\">.</span>3=node2:2888:3888</pre></td></tr></table></figure><p>在 /opt/bigdata/zookeeper-3.6.2 / 这个目录上创建 zkData 文件夹</p>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master zookeeper-3.6.2]</span>$ mkdir zkData</pre></td></tr></table></figure><h2 id=\"2-zookeeper启动与操作\"><a class=\"anchor\" href=\"#2-zookeeper启动与操作\">#</a> 2、 Zookeeper 启动与操作</h2>\n<h3 id=\"启动zookeeper\"><a class=\"anchor\" href=\"#启动zookeeper\">#</a> 启动 Zookeeper</h3>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master zookeeper-3.6.2]</span><span class=\"token variable\">$bin</span><span class=\"token operator\">/</span>zkServer<span class=\"token punctuation\">.</span>sh <span class=\"token function\">start</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ZooKeeper JMX enabled by default</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">Using</span> config: <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>bigdata<span class=\"token operator\">/</span>zookeeper<span class=\"token operator\">-</span>3<span class=\"token punctuation\">.</span>6<span class=\"token punctuation\">.</span>2<span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>conf<span class=\"token operator\">/</span>zoo<span class=\"token punctuation\">.</span>cfg</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Starting zookeeper <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> STARTED     <span class=\"token comment\"># 这时，一般就启动成功了</span></pre></td></tr></table></figure><h3 id=\"查看进程是否启动\"><a class=\"anchor\" href=\"#查看进程是否启动\">#</a> 查看进程是否启动</h3>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master zookeeper-3.6.2]</span><span class=\"token variable\">$jps</span></pre></td></tr></table></figure><h3 id=\"查看状态\"><a class=\"anchor\" href=\"#查看状态\">#</a> 查看状态</h3>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master zookeeper-3.6.2]</span><span class=\"token variable\">$bin</span><span class=\"token operator\">/</span>zkServer<span class=\"token punctuation\">.</span>sh status</pre></td></tr></table></figure><h3 id=\"启动客户端\"><a class=\"anchor\" href=\"#启动客户端\">#</a> 启动客户端</h3>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master zookeeper-3.6.2]</span><span class=\"token variable\">$bin</span><span class=\"token operator\">/</span>zkCli<span class=\"token punctuation\">.</span>sh</pre></td></tr></table></figure><h3 id=\"退出客户端\"><a class=\"anchor\" href=\"#退出客户端\">#</a> 退出客户端</h3>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[zk: localhost:2181(CONNECTED) 0]</span> quit</pre></td></tr></table></figure><h3 id=\"停用zookeeper\"><a class=\"anchor\" href=\"#停用zookeeper\">#</a> 停用 Zookeeper</h3>\n<figure class=\"highlight powershell\"><figcaption data-lang=\"PowerShell\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token namespace\">[root@master zookeeper-3.6.2]</span><span class=\"token variable\">$bin</span><span class=\"token operator\">/</span>zkServer<span class=\"token punctuation\">.</span>sh stop</pre></td></tr></table></figure>",
            "tags": []
        },
        {
            "id": "https://methiony.work/2020/11/19/Platform-construction/Hbase/Hbase/",
            "url": "https://methiony.work/2020/11/19/Platform-construction/Hbase/Hbase/",
            "title": "Hbase",
            "date_published": "2020-11-19T07:53:18.000Z",
            "content_html": "<h1 id=\"hbase基础系列1\"><a class=\"anchor\" href=\"#hbase基础系列1\">#</a> Hbase 基础系列（1）</h1>\n<h2 id=\"1-hbase定义\"><a class=\"anchor\" href=\"#1-hbase定义\">#</a> 1、 HBase 定义</h2>\n<p>HBase 是一种分布式、可扩展、支持海量数据存储的 NoSQL 数据库。</p>\n<h2 id=\"2-hbase特点\"><a class=\"anchor\" href=\"#2-hbase特点\">#</a> 2、HBase 特点</h2>\n<ul>\n<li>1. 海量存储</li>\n</ul>\n<p>Hbase 适合存储 PB 级别的海量数据，在 PB 级别的数据以及采用廉价 PC 存储的情况下，能在几十到百毫秒内返回数据。这与 Hbase 的极易扩展性息息相关。正式因为 Hbase 良好的扩展性，才为海量数据的存储提供了便利。</p>\n<ul>\n<li>2. 列式存储</li>\n</ul>\n<p>这里的列式存储其实说的是列族存储，Hbase 是根据列族来存储数据的。列族下面可以有非常多的列，列族在创建表的时候就必须指定。</p>\n<ul>\n<li>3. 极易扩展</li>\n</ul>\n<p>Hbase 的扩展性主要体现在两个方面，一个是基于上层处理能力（RegionServer）的扩展，一个是基于存储的扩展（HDFS）。<br />\n通过横向添加 RegionSever 的机器，进行水平扩展，提升 Hbase 上层的处理能力，提升 Hbsae 服务更多 Region 的能力。<br />\n  备注：RegionServer 的作用是管理 region、承接业务的访问，这个后面会详细的介绍通过横向添加 Datanode 的机器，进行存储层扩容，提升 Hbase 的数据存储能力和提升后端存储的读写能力。</p>\n<ul>\n<li>4. 高并发</li>\n</ul>\n<p>由于目前大部分使用 Hbase 的架构，都是采用的廉价 PC，因此单个 IO 的延迟其实并不小，一般在几十到上百 ms 之间。这里说的高并发，主要是在并发的情况下，Hbase 的单个 IO 延迟下降并不多。能获得高并发、低延迟的服务。</p>\n<ul>\n<li>5. 稀疏</li>\n</ul>\n<p>稀疏主要是针对 Hbase 列的灵活性，在列族中，你可以指定任意多的列，在列数据为空的情况下，是不会占用存储空间的。</p>\n<h2 id=\"3-hbase的数据模型\"><a class=\"anchor\" href=\"#3-hbase的数据模型\">#</a> 3、Hbase 的数据模型</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovLzEuTmFtZQ==\">1.Name</span> Space</li>\n</ul>\n<p>命名空间，类似于关系型数据库的 database 概念，每个命名空间下有多个表。HBase 两个自带的命名空间，分别是 hbase 和 default，hbase 中存放的是 HBase 内置的表，default 表是用户默认使用的命名空间。</p>\n<ul>\n<li>2.Table</li>\n</ul>\n<p>类似于关系型数据库的表概念。不同的是，HBase 定义表时只需要声明列族即可，不需要声明具体的列。这意味着，往 HBase 写入数据时，字段可以动态、按需指定。因此，和关系型数据库相比，HBase 能够轻松应对字段变更的场景。</p>\n<ul>\n<li>3.Row</li>\n</ul>\n<p>HBase 表中的每行数据都由一个 RowKey 和多个 Column（列）组成，数据是按照 RowKey 的字典顺序存储的，并且查询数据时只能根据 RowKey 进行检索，所以 RowKey 的设计十分重要。</p>\n<ul>\n<li>4.Column</li>\n</ul>\n<p>HBase 中的每个列都由 Column Family (列族) 和 Column Qualifier（列限定符）进行限定，例如 info：name，info：age。建表时，只需指明列族，而列限定符无需预先定义。</p>\n<ul>\n<li>5.Time Stamp</li>\n</ul>\n<p>用于标识数据的不同版本（version），每条数据写入时，系统会自动为其加上该字段，其值为写入 HBase 的时间。</p>\n<ul>\n<li>6.Cell</li>\n</ul>\n<p>由 {rowkey, column Family：column Qualifier, time Stamp} 唯一确定的单元。cell 中的数据是没有类型的，全部是字节码形式存贮。</p>\n<h2 id=\"4-hbase架构\"><a class=\"anchor\" href=\"#4-hbase架构\">#</a> 4、 HBase 架构</h2>\n<ul>\n<li>1.Client</li>\n</ul>\n<p>Client 包含了访问 Hbase 的接口，另外 Client 还维护了对应的 cache 来加速 Hbase 的访问，比如 cache 的.META. 元数据的信息。</p>\n<ul>\n<li>2.Zookeeper</li>\n</ul>\n<p>HBase 通过 Zookeeper 来做 master 的高可用、RegionServer 的监控、元数据的入口以及集群配置的维护等工作。具体工作如下：</p>\n<blockquote>\n<p>通过 Zoopkeeper 来保证集群中只有 1 个 master 在运行，如果 master 异常，会通过竞争机制产生新的 master 提供服务<br />\n通过 Zoopkeeper 来监控 RegionServer 的状态，当 RegionSevrer 有异常的时候，通过回调的形式通知 MasterRegionServer 上下线的信息<br />\n通过 Zoopkeeper 存储元数据的统一入口地址</p>\n</blockquote>\n<ul>\n<li>3.Hmaster</li>\n</ul>\n<p>master 节点的主要职责如下：</p>\n<blockquote>\n<p>为 RegionServer 分配 Region<br />\n 维护整个集群的负载均衡<br />\n维护集群的元数据信息<br />\n发现失效的 Region，并将失效的 Region 分配到正常的 RegionServer 上<br />\n当 RegionSever 失效的时候，协调对应 Hlog 的拆分</p>\n</blockquote>\n<ul>\n<li>4.HregionServer</li>\n</ul>\n<p>HregionServer 直接对接用户的读写请求，是真正的 “干活” 的节点。它的功能概括如下：</p>\n<blockquote>\n<p>管理 master 为其分配的 Region<br />\n 处理来自客户端的读写请求<br />\n负责和底层 HDFS 的交互，<br />\n存储数据到 HDFS<br />\n 负责 Region 变大以后的拆分<br />\n负责 Storefile 的合并工作</p>\n</blockquote>\n<ul>\n<li>5.HDFS</li>\n</ul>\n<p>HDFS 为 Hbase 提供最终的底层数据存储服务，同时为 HBase 提供高可用（Hlog 存储在 HDFS）的支持，具体功能概括如下：</p>\n<blockquote>\n<p>提供元数据和表数据的底层分布式存储服务<br />\n数据多副本，保证的高可靠和高可用性</p>\n</blockquote>\n<h2 id=\"5-hbase中的角色\"><a class=\"anchor\" href=\"#5-hbase中的角色\">#</a> 5、HBase 中的角色</h2>\n<h4 id=\"1-hmaster\"><a class=\"anchor\" href=\"#1-hmaster\">#</a> 1 HMaster</h4>\n<ul>\n<li>功能</li>\n<li>1．监控 RegionServer</li>\n<li>2．处理 RegionServer 故障转移</li>\n<li>3．处理元数据的变更</li>\n<li>4．处理 region 的分配或转移</li>\n<li>5．在空闲时间进行数据的负载均衡</li>\n<li>6．通过 Zookeeper 发布自己的位置给客户端</li>\n</ul>\n<h4 id=\"2-regionserver\"><a class=\"anchor\" href=\"#2-regionserver\">#</a> 2 RegionServer</h4>\n<ul>\n<li>功能</li>\n<li>1．负责存储 HBase 的实际数据</li>\n<li>2．处理分配给它的 Region</li>\n<li>3．刷新缓存到 HDFS</li>\n<li>4．维护 Hlog</li>\n<li>5．执行压缩</li>\n<li>6．负责处理 Region 分片</li>\n</ul>\n<h4 id=\"3-其他组件\"><a class=\"anchor\" href=\"#3-其他组件\">#</a> 3. 其他组件</h4>\n<ul>\n<li>1．Write-Ahead logs</li>\n</ul>\n<p>HBase 的修改记录，当对 HBase 读写数据的时候，数据不是直接写进磁盘，它会在内存中保留一段时间（时间以及数据量阈值可以设定）。但把数据保存在内存中可能有更高的概率引起数据丢失，为了解决这个问题，数据会先写在一个叫做 Write-Ahead logfile 的文件中，然后再写入内存中。所以在系统出现故障的时候，数据可以通过这个日志文件重建。</p>\n<ul>\n<li>2．Region</li>\n</ul>\n<p>Hbase 表的分片，HBase 表会根据 RowKey 值被切分成不同的 region 存储在 RegionServer 中，在一个 RegionServer 中可以有多个不同的 region。</p>\n<ul>\n<li>3．Store</li>\n</ul>\n<p>HFile 存储在 Store 中，一个 Store 对应 HBase 表中的一个列族。</p>\n<ul>\n<li>4．MemStore</li>\n</ul>\n<p>顾名思义，就是内存存储，位于内存中，用来保存当前的数据操作，所以当数据保存在 WAL 中之后，RegsionServer 会在内存中存储键值对。</p>\n<ul>\n<li>5．HFile</li>\n</ul>\n<p>这是在磁盘上保存原始数据的实际的物理文件，是实际的存储文件。StoreFile 是以 Hfile 的形式存储在 HDFS 的。</p>\n",
            "tags": []
        },
        {
            "id": "https://methiony.work/2020/11/15/MySQL/",
            "url": "https://methiony.work/2020/11/15/MySQL/",
            "title": "MySQL",
            "date_published": "2020-11-15T10:43:49.000Z",
            "content_html": "<h2 id=\"mysql服务的登录和退出\"><a class=\"anchor\" href=\"#mysql服务的登录和退出\">#</a> MySql 服务的登录和退出</h2>\n<p>​\t\t方式一：通过 mysql 自带的客户端：只限于 root 用户</p>\n<p>​\t\t方式二：通过 Windows 自带的客户端：1、登录：</p>\n<pre><code class=\"language-mysql\">mysql\t[-h主机名\t-p端口号]\t-u用户名\t-p 密码\n</code></pre>\n<p>​\t\t退出：</p>\n<pre><code class=\"language-mysql\">exit或ctrl + c\n</code></pre>\n<h2 id=\"mysql的常见命令\"><a class=\"anchor\" href=\"#mysql的常见命令\">#</a> MySql 的常见命令</h2>\n<p>​\t\t1、查看当前所有的数据库：</p>\n<pre><code class=\"language-mysql\">show\tdatabases;\n</code></pre>\n<p>​\t\t2、打开指定的库：</p>\n<pre><code class=\"language-mysql\">use\t库名\n</code></pre>\n<p>​\t\t3、查看当前库的所有表：</p>\n<pre><code class=\"language-mysql\">show\ttables;\n</code></pre>\n<p>​\t\t4、查看其他库的所有表：</p>\n<pre><code class=\"language-mysql\">show\ttables\tfrom\t库名;\n</code></pre>\n<p>​\t\t5、创建表：</p>\n<pre><code class=\"language-mysql\">create\ttable\t表名(\n\n​\t\t\t\t\t\t列名\t列类型,\n\n​\t\t\t\t\t\t列名\t列类型,\n\n​\t\t\t\t\t\t...\n\n​\t\t\t)\n</code></pre>\n<p>​\t\t6、查看表结构：</p>\n<pre><code class=\"language-mysql\">desc\t表名;\n</code></pre>\n<p>​\t\t7、查看服务器的版本</p>\n<p>​\t\t\t方式一、登录到 mysql 服务端:</p>\n<pre><code class=\"language-mysql\">select\tversion();\n</code></pre>\n<p>​\t\t\t方式二、没有登录到 mysql 服务端:</p>\n<pre><code class=\"language-mysql\">mysql\t--version或\tmysql\t--v\n</code></pre>\n<h3 id=\"进阶1基础查询\"><a class=\"anchor\" href=\"#进阶1基础查询\">#</a> 进阶 1：基础查询</h3>\n<p>语法：</p>\n<pre><code class=\"language-mysql\">select\t查询列表\tfrom\t表名;\n</code></pre>\n<p>特点：</p>\n<p>1、查询列表可以是：表中的字段、常量值、表达式、函数</p>\n<p>2、查询的结果是一个虚拟的表格</p>\n<p>a、查询表中的单个字段：</p>\n<pre><code class=\"language-mysql\">select\t查询列表\tfrom\t表名;\n</code></pre>\n<p>b、查询表中的多个字段：</p>\n<pre><code class=\"language-mysql\">select\t查询列表1,查询列表2,...\tfrom\t表名;\n</code></pre>\n<p>c、查询表中的所有字段：</p>\n<pre><code class=\"language-mysql\">select\t*\tfrom\t表名;\n</code></pre>\n<p>d、查询常量值：</p>\n<pre><code class=\"language-mysql\">select\t100;\tselect\t'john';\n</code></pre>\n<p>e、查询表达式：</p>\n<pre><code class=\"language-mysql\">select\t100%98;\n</code></pre>\n<p>f、查询函数：</p>\n<pre><code class=\"language-mysql\">select\tversion();\n</code></pre>\n<p>3、起别名：便于理解、如果查询的字段有重名的情况，使用别名区分</p>\n<p>a、使用 as</p>\n<pre><code class=\"language-mysql\">select\t100%98\tas\t结果;\n</code></pre>\n<pre><code class=\"language-mysql\">select\t查询列表1 as 别名,查询列表2 as 别名\tfrom\t表名;\n</code></pre>\n<p>b、使用空格</p>\n<pre><code class=\"language-mysql\">select\t查询列表1  别名,查询列表2  别名\tfrom\t表名;\n</code></pre>\n<p>4、去重</p>\n<pre><code class=\"language-mysql\">select\tdistinct\t查询列表\tfrom\t表名;\n</code></pre>\n<h3 id=\"进阶2条件查询\"><a class=\"anchor\" href=\"#进阶2条件查询\">#</a> 进阶 2：条件查询</h3>\n<p>语法：</p>\n<pre><code class=\"language-mysql\">select\t查询列表\tfrom\t表名\twhere\t筛选条件;\n</code></pre>\n<p>分类：</p>\n<p>一、按条件表达式筛选</p>\n<p>简单条件运算符：</p>\n<pre><code class=\"language-mysql\">&gt;\t&lt;\t=\t!=\t&lt;&gt;\t&gt;=\t&lt;=\n</code></pre>\n<p>二、按逻辑表达式筛选</p>\n<p>逻辑运算符：</p>\n<pre><code class=\"language-mysql\">&amp;&amp;\t||\t！\tand\tor\tnot\n</code></pre>\n<p>三、模糊查询</p>\n<pre><code class=\"language-mysql\">like\tbetween\tand\tin\tis\tnull\n</code></pre>\n<h2 id=\"mysql的语法规范\"><a class=\"anchor\" href=\"#mysql的语法规范\">#</a> Mysql 的语法规范</h2>\n<p>​\t\t\t1、不区分大小写，但建议关键词大写，表名、列名小写</p>\n<p>​\t\t\t2、每条命令最好用分号结尾</p>\n<p>​\t\t\t3、每条命令根据需要，可以进行缩进或换行</p>\n<p>​\t\t\t4、注释：a、单行注释：# 注释文字\tb、单行注释：-- 注释文字\tc、单行注释：/ *   注释文字   */</p>\n<p>​\t\t\t5、mysql 中的 + 号：只有作为运算符的功能</p>\n",
            "tags": []
        }
    ]
}